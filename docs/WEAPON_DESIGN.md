# 武器设计文档

本文档记录已完成的武器设计详情，为后续武器设计提供模板参考。

---

## 通用设计原则

### 伤害公式
所有武器伤害基于统一的 `baseAttack` 计算：
```
baseAttack = 1 + 外围攻击等级
武器伤害 = baseAttack × basePct × (1 + damageLv × 0.5)
```

### 升级树设计原则
1. **基础分支（无前置）**：伤害、频率/冷却、数量等核心属性
2. **进阶分支（有前置）**：需要点满基础分支才能解锁
3. **终极分支（多前置）**：需要多个分支达到一定等级
4. **分支数量**：建议 6-9 个分支
5. **流派设计**：每个武器应有 2-3 条不同的 Build 路线

### 视觉效果原则
- 升级应有明显的视觉反馈
- 避免使用 `shadowBlur` 和 `createRadialGradient`（性能杀手）
- 批量渲染同类元素减少 Draw Call
- 特效持续时间要适中，太短看不清，太长影响性能

---

## 💣 光能迫击炮 (kunai)

### 基础信息
| 属性 | 值 |
|------|-----|
| 名称 | 光能迫击炮 |
| 图标 | 💣 |
| 颜色 | #00FFFF (青色) |
| basePct | 1.2 (120%) |
| interval | 1800ms |
| 机制 | 发射炮弹，命中爆炸造成 AOE 伤害 |

### 升级树（9分支）

| 分支 | 名称 | 效果 | max | 前置 | 说明 |
|------|------|------|-----|------|------|
| damage | 伤害 | +50%直击伤害 | 5 | - | 基础分支 |
| aoe | 范围 | +25%爆炸范围 | 4 | - | 基础分支 |
| count | 数量 | +1发炮弹 | 3 | - | 基础分支 |
| pierce | 穿透 | 穿透砖块，末端爆炸 | 2 | damage:2 | 只在最后命中时爆炸 |
| pierceBlast | 穿透爆破 | 穿透时每次命中都爆炸 | 1 | pierce:2 | 穿透流终极 |
| homing | 追踪 | +30%追踪能力 | 2 | count:2 | 炮弹自动追踪 |
| chain | 连锁 | 爆炸触发连锁 | 2 | aoe:3 | 爆炸中心再爆炸 |
| giant | 巨型弹头 | 弹体×1.8，伤害+80% | 1 | damage:4, aoe:3 | 终极分支 |
| splash | 溅射 | +20%溅射伤害 | 3 | aoe:2 | AOE流强化 |

### 伤害公式
```javascript
// 直击伤害
directDmg = baseAttack × 1.2 × (1 + damageLv × 0.5)

// 溅射伤害 (60% + 溅射加成)
splashDmg = directDmg × (0.6 + splashLv × 0.2)

// 巨型弹头加成
if (giantLv > 0) directDmg × 1.8
```

### 视觉效果
- **弹体**：圆头炮弹 + 尾翼 + 推进火焰 + 烟雾拖尾
- **尺寸联动**：弹体大小 = 1.0 + aoeLv × 0.2，巨型弹头 ×1.8
- **爆炸**：圆形扩散 + 粒子飞溅（避免 shadowBlur）

### Build 路线
1. **穿透流**：damage → pierce → pierceBlast（单体高伤）
2. **AOE流**：aoe → splash → chain（范围清怪）
3. **数量流**：count → homing（多弹追踪）

---

## ⚡ 闪电链 (lightning)

### 基础信息
| 属性 | 值 |
|------|-----|
| 名称 | 闪电链 |
| 图标 | ⚡ |
| 颜色 | #FFF050 (黄色) |
| basePct | 1.2 (120%) |
| interval | 2500ms |
| 机制 | 自动锁定砖块释放闪电，可链式跳跃 |

### 升级树（9分支）

| 分支 | 名称 | 效果 | max | 前置 | 说明 |
|------|------|------|-----|------|------|
| damage | 伤害 | +50%基础伤害 | 5 | - | 基础分支 |
| chains | 链数 | +1跳跃目标 | 4 | - | 基础分支，核心 |
| freq | 频率 | -20%冷却 | 3 | - | 基础分支 |
| paralyze | 麻痹 | 命中减速30% | 2 | chains:2 | 控制效果 |
| storm | 雷暴 | 同时释放2道闪电 | 2 | freq:2 | 数量翻倍 |
| charge | 蓄能 | 每次链跳+25%伤害 | 2 | chains:2 | 链数越多伤害越高 |
| shock | 感电 | 命中留DOT(30%/秒×2秒) | 2 | damage:2 | 持续伤害 |
| echo | 回响 | 链末端20%再次释放 | 2 | chains:3 | 概率连锁 |
| overload | 超载 | 链末端爆炸AOE | 1 | chains:4, damage:3 | 终极分支 |

### 伤害公式
```javascript
// 基础伤害
baseDmg = baseAttack × 1.2 × (1 + damageLv × 0.5)

// 蓄能加成（每次链跳递增）
chainMult = 1 + chainIndex × chargeLv × 0.25
actualDmg = baseDmg × chainMult

// 感电DOT
dotDmg = baseDmg × 0.3 × shockLv  // 每秒伤害，持续2秒

// 超载爆炸
aoeeDmg = actualDmg × 0.6
```

### 视觉效果
- **3层闪电**：
  - 外层光晕 (16px, 15%透明度)
  - 主体闪电 (4px, 抖动效果)
  - 白色内芯 (2px)
- **分支闪电**：节点 60% 概率分出小分支
- **命中点光效**：3层发光圈（大→中→核心）
- **链间电弧**：相邻命中点之间额外小闪电
- **持续时间**：alpha 衰减 0.025/帧，比默认更持久

### Build 路线
1. **链数流**：chains → charge → echo → overload（多跳高伤害）
2. **伤害流**：damage → shock + freq → storm（持续DOT）
3. **控制流**：chains → paralyze（减速控场）

---

## 武器设计模板

### 新武器设计清单

```markdown
## [图标] 武器名称 (英文key)

### 基础信息
| 属性 | 值 |
|------|-----|
| 名称 | |
| 图标 | |
| 颜色 | |
| basePct | |
| interval | |
| 机制 | |

### 升级树

| 分支 | 名称 | 效果 | max | 前置 | 说明 |
|------|------|------|-----|------|------|
| damage | 伤害 | +50%伤害 | 5 | - | 基础 |
| ... | | | | | |

### 伤害公式
(写出具体计算逻辑)

### 视觉效果
- 弹体/攻击形态：
- 命中效果：
- 特殊效果：

### Build 路线
1. **XX流**：分支A → 分支B → 分支C（说明）
2. **YY流**：...
```

---

## 🤖 攻击无人机 (drone)

### 基础信息
| 属性 | 值 |
|------|-----|
| 名称 | 攻击无人机 |
| 图标 | 🤖 |
| 颜色 | #50FFB4 (薄荷绿) |
| basePct | 0.8 (80%) |
| interval | 800ms |
| 机制 | 无人机环绕飞机旋转，自动锁定射击 |

### 升级树（9分支）

| 分支 | 名称 | 效果 | max | 前置 | 说明 |
|------|------|------|-----|------|------|
| damage | 伤害 | +50%基础伤害 | 5 | - | 基础分支 |
| count | 数量 | +1台无人机 | 3 | - | 基础分支，核心 |
| fireRate | 射速 | +25%攻击频率 | 3 | - | 基础分支 |
| range | 射程 | +20%攻击距离 | 2 | - | 基础分支 |
| burst | 连射 | 每次射3发 | 2 | fireRate:2 | 弹幕强化 |
| pierce | 穿透 | 子弹穿透+1目标 | 2 | damage:2 | 穿透流 |
| swarm | 蜂群 | 攻速狂暴+50% | 2 | count:2, fireRate:2 | 终极射速 |
| shield | 护盾 | 无人机可挡1次伤害 | 1 | count:3 | 防御 |
| laser | 激光模式 | 改为持续激光 | 1 | count:2, damage:4 | 终极分支 |

### 伤害公式
```javascript
// 基础伤害
damage = baseAttack × 0.8 × (1 + damageLv × 0.5)

// 激光模式：伤害×1.5
if (laserLv > 0) damage × 1.5

// 射速计算
interval = 800ms × 0.75^fireRateLv × 0.5^swarmLv
```

### 视觉效果
- **无人机**：矩形机身 + 机翼 + 白色驾驶舱 + 引擎光点
- **护盾**：薄荷绿圆形光环，破碎时白光闪烁
- **蜂群**：旋转轨迹光效，引擎变黄色
- **激光**：双层光束（外层光晕 + 白芯）+ 命中点光效

### Build 路线
1. **射速流**：fireRate → burst → swarm（疯狂输出）
2. **激光流**：count → damage → laser（高伤持续）
3. **坦克流**：count → shield（防御 + 数量）

---

## 🌀 等离子旋刃 (spinBlade)

### 基础信息
| 属性 | 值 |
|------|-----|
| 名称 | 等离子旋刃 |
| 图标 | 🌀 |
| 颜色 | #AA44FF (紫色) |
| basePct | 0.6 (60%) |
| interval | 3000ms |
| tickInterval | 200ms |
| 机制 | 发射旋刃持续移动切割，每200ms造成伤害 |

### 升级树（9分支）

| 分支 | 名称 | 效果 | max | 前置 | 说明 |
|------|------|------|-----|------|------|
| damage | 伤害 | +50%基础伤害 | 5 | - | 基础分支 |
| count | 刃数 | +1把旋刃 | 3 | - | 基础分支 |
| duration | 持续 | +1秒存在时间 | 3 | - | 基础分支 |
| speed | 移速 | +30%飞行速度 | 2 | - | 基础分支 |
| giant | 巨型化 | 旋刃体积翻倍 | 2 | duration:2 | 范围强化 |
| homing | 追踪 | +30%追踪能力 | 2 | speed:2 | 智能跟踪 |
| return | 回旋 | 到达后返回飞机 | 1 | duration:2, speed:1 | 双向伤害 |
| vortex | 漩涡 | 吸引周围经验球 | 2 | giant:1 | 功能性 |
| bounce | 弹射 | 碰壁反弹继续飞 | 1 | count:2, speed:2 | 终极分支 |

### 伤害公式
```javascript
// 每tick伤害（200ms一次）
tickDmg = baseAttack × 0.6 × (1 + damageLv × 0.5)

// 持续时间
durationMs = (3 + durationLv) × 1000

// 总伤害 = tickDmg × (duration / tickInterval)
```

### 视觉效果
- **旋刃**：4叶旋刃（曲线造型）+ 中心白点 + 外层光晕
- **巨型化**：额外白色圆环
- **漩涡**：范围圈 + 螺旋线（随旋刃旋转）

### Build 路线
1. **持续流**：duration → giant → vortex（长时间 + 吸经验）
2. **追踪流**：speed → homing → return（智能往返）
3. **数量流**：count → speed → bounce（多刃弹墙）

---

## 待设计武器

- 🚀 追踪导弹 (missile) - 已有基础，待整理
- ☄ 天降陨石 (meteor) - 待设计升级树

---

*文档版本: v1.1*
*最后更新: 2026-02-20*
