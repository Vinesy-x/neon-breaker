# 外部养成平衡方法论

> 从 neon-breaker 武器平衡实战中提炼，适用于所有"多角色/多武器 × 等级成长"的数值体系。
>
> 2026-03-01 by 阿喵 & Vin

---

## 一、核心理念

### 1. 乘区分离

DPS = **基础伤害** × **共享成长曲线** × **个体爽点缩放** × **被动加成**

每个乘区独立控制，互不干扰。调数值时先定位是哪个乘区出了问题，不要乱改。

| 乘区 | 控制什么 | 调谁 |
|------|---------|------|
| 共享成长曲线 | 所有武器的基础涨幅 | dmgMultPerBracket |
| 个体爽点 | 单个武器的独特缩放 | sweetSpot (CD/数量/射速) |
| 被动/分支 | 特定等级解锁的增益 | 各武器被动倍率 |

### 2. 标定锚点

先定一个标准：**每10级商店等级 ≈ DPS ×3**

所有武器都往这个锚点靠。不需要精确等于3，±30%内都健康（×2.1~×3.9）。

### 3. 定位决定数值，不是数值决定定位

不同武器有不同定位（AOE/单体/辅助/基底），DPS不需要完全相同。但**同定位武器的DPS差距不应超过2x**。

---

## 二、共享成长曲线设计

```
dmgMultPerBracket: [0.12, 0.20, 0.35, 0.36, 0.38]
                    Lv1-5  6-10  11-15 16-20  21+
```

### 设计原则

1. **前低后高**：低等级涨幅小（玩家刚接触），高等级涨幅大（给养成目标感）
2. **5的倍数留给爽点**：每5级跳过一次dmgMult，改为触发爽点属性，制造"升级大跳"的爽感
3. **bracket之间有递进**：0.12→0.20→0.35→0.36→0.38，中期(bracket3)跳最大，给15级左右一个明显的体感拐点

### 暴伤曲线

```
critBonusPerBracket: [0.01, 0.02, 0.03, 0.04, 0.05]
```

暴伤是隐性乘区，单武器满级约+100%暴伤。多武器全满级时暴伤叠加很高，是**后期联合输出爆炸的隐藏推手**，需要注意。

---

## 三、爽点(sweetSpot)设计

爽点是每5级触发一次的**核心缩放机制**，决定武器的DPS曲线形状。

### 两种模型

| 模型 | 公式 | 效果 | 适用 |
|------|------|------|------|
| **CD除法型** | base + ticks × delta | 频率越来越快，后期加速感强 | 射击类、投弹类 |
| **数量加法型** | base + ticks × delta | 覆盖面线性增长，稳定可预期 | 链数、弹数、冰墙数 |

### ⚠️ 绝对不要用加法射速倍率

```
❌ fireRate: base=1.0, delta=+0.08  → Lv10=1.16, Lv20=1.32, 频率比=×1.14 (几乎没感觉)
✅ cd: base=800, delta=-80           → Lv10=640ms, Lv20=480ms, 频率比=×1.33 (明显加速)
```

**加法倍率的致命问题**：高等级时增量占比越来越小（1.32→1.48只+12%），玩家感知不到成长。CD除法型天然有"越快越爽"的加速感。

### 爽点强度校准

目标：爽点贡献的频率/覆盖面提升，配合共享曲线，刚好凑出 ×3/10级。

粗算公式：共享曲线10级倍率 × 爽点10级倍率 ≈ 3

如果共享曲线10级给 ×2.25，爽点需要贡献 ×1.33（即频率提升33%）。

---

## 四、被动设计红线

### 绝对禁止

| 类型 | 举例 | 为什么 |
|------|------|--------|
| **纯乘法×2以上** | 弹数×2、伤害×3 | 一个被动就吃掉10级的成长空间 |
| **频率×乘法双重** | 射速+50% 且 弹数×2 | 两个乘区同时爆炸 |
| **无上限叠加** | 每次击杀+5%伤害，不封顶 | 后期趋近无穷 |

### 安全范围

| 类型 | 安全值 | 举例 |
|------|--------|------|
| 加法增伤 | +30%~+50% | 元素亲和+30% |
| 乘法系数 | ×1.3~×1.5 | 末日弹幕×1.5 |
| CD缩短 | ×0.67~×0.8 | 超频引擎×0.67 |
| 额外数量 | +1~+3 | 穿透+3 |

### 实战教训

| 被动 | 原始 | 问题 | 修正 |
|------|------|------|------|
| 末日弹幕 | 弹数×2 | 跟AOE+频率三重乘法 | ×1.5 |
| 雷神降临 | 30s/伤害×2 | 高频+高伤一个被动顶半个武器 | 60s/伤害×1 |
| 超频引擎 | 射速+50%(加法) | 跟CD型爽点冲突 | ×0.67系数 |

---

## 五、独立系统的养成接入检查

### 问题

有些系统（如飞机子弹）不走统一的 Weapon.getDamage() 管线，可能漏掉商店养成倍率。

### 检查清单

每个伤害源都要问：

1. ✅ 是否乘了 getDmgMultiplier(weaponLevel)？
2. ✅ 是否乘了暴击系统？
3. ✅ 是否接入了爽点属性？
4. ✅ 改了商店等级后，DPS有没有变化？（沙盒验证）

**飞机就是因为第1条漏了，导致外部养成完全无效，Lv10→30 DPS只涨了×2。**

---

## 六、沙盒测试方法论

### 控制变量

测外部养成时：
- 目标武器设目标等级，其他武器 Lv1
- **内部升级树要控制**（如飞机的fireRate满级会淹没外部差异）
- 砖块存活数固定（targetAlive:60），保证有东西打

### 批量测试模板

```
12组 = 4武器 × 3等级(10/20/30)
+ 1组全武器满级联合
= 13组，每组60-90秒，10倍速
总耗时 ≈ 200秒
```

### 关注指标

| 指标 | 健康范围 | 红灯 |
|------|---------|------|
| 10→20 倍率 | ×2.1~×3.9 | <×1.5 或 >×5 |
| 20→30 倍率 | ×2.1~×3.9 | <×1.5 或 >×5 |
| Lv30 最强/最弱 | ≤2x | >3x |
| 联合占比最高 | ≤35% | >40% |
| 联合占比最低 | ≥8% | <5% |

### 迭代节奏

1. **先看数据，再动刀** — 不要凭感觉调，跑一轮沙盒再说
2. **每轮最多改3个参数** — 改太多分不清哪个生效
3. **改完必跑验证** — 不跑不算改完
4. **记录每轮数据** — 方便回溯

---

## 七、从13.7x到1.1x：迭代复盘

| 轮次 | Lv30 最强/最弱 | 关键操作 |
|------|---------------|---------|
| 初始 | **13.7x** | 冰爆弹41k vs 穿甲弹3k |
| R1 | 7.6x | 共享曲线拉陡，轰炸机爽点→CD型 |
| R2 | 5.8x | 雷神CD 30s→60s，穿甲弹basePct翻倍 |
| R3 | 2.2x | 穿甲弹齐射改多列散射（后回滚） |
| R4 | 2.5x | 穿甲弹回归同列连射，保特色 |
| R8 | **1.3x** | 穿甲弹渐进扩列（低级单列→高级4列） |
| R9 | **1.1x** | 冰爆弹溅射/半径下调，飞机接入商店养成 |

### 关键转折点

1. **发现乘区爆炸**（R1）：末日弹幕×2 + AOE + 频率三重乘法 = 冰爆弹碾压
2. **尊重武器特色**（R4）：穿甲弹多列散射DPS好看但失去"穿甲"身份 → 回滚
3. **渐进解锁覆盖面**（R8）：低级单列 → 高级4列，既保特色又给成长感
4. **独立系统漏养成**（R9）：飞机子弹不走Weapon管线，商店等级白升

---

## 八、通用平衡检查清单（新武器/新系统必过）

- [ ] basePct + interval 参考同类已有武器
- [ ] 爽点类型选定（CD型还是数量型？）
- [ ] 预估 Lv10/20/30 DPS（公式粗算）
- [ ] 沙盒跑 Lv10/20/30 验证
- [ ] 10→20 和 20→30 倍率在 ×2.1~×3.9
- [ ] Lv30 DPS 在同定位武器的 ±50% 内
- [ ] 被动没有 ×2 以上的纯乘法
- [ ] 联合测试占比不超过 35%
- [ ] 伤害源接入了商店养成倍率
- [ ] 伤害源接入了暴击系统

---

*"数值平衡不是一次性的工作，是一个观察→假设→验证→迭代的科学过程。每一轮只改一点，跑数据说话。"*

*— 阿喵的游戏基因 🐾*

---

## 九、实战踩坑经验

### 1. 配置改了但逻辑没读

**场景**：雷神降临配置写了 `thorInterval: 60000`，但 Lightning.js 里硬编码 `30000`，改配置白改。

**教训**：改完配置后，**grep 一下逻辑代码有没有硬编码同一个值**。配置和逻辑必须是同一条线。

```bash
# 改完配置后必跑
grep -rn "30000\|硬编码的值" src/weapons/ --include="*.js"
```

### 2. sed 误伤

**场景**：用 `sed` 改穿甲弹 `interval: 8000` 时，白磷弹也有 `interval: 8000`，被一起改了。

**教训**：sed 替换要带足够上下文，或者用 python 精确定位。对配置文件最好直接编辑器改。

### 3. 沙盒和实际游戏的差异

| 沙盒环境 | 实际游戏 | 影响 |
|---------|---------|------|
| 内部升级全满级 | 逐渐升级 | 飞机射速被内部升级淹没外部差异 |
| 固定砖块密度 | 波次递进 | AOE武器在密集波次更强 |
| 无Boss | 有Boss | 单体武器对Boss有额外价值 |
| AI自动移动 | 玩家操作 | 穿甲弹瞄准效率受玩家走位影响 |

**教训**：沙盒测的是理论DPS天花板，实际手感还需要真机体验。**沙盒定方向，真机定感觉**。

### 4. DPS不等于强度

穿甲弹联合占比10.7%看似最弱，但它的**碎甲标记**让其他武器对被标记砖块增伤。这种辅助价值沙盒数据看不出来。

**教训**：武器强度 = 自身DPS + 对团队的增益。辅助型武器DPS低是正常的，不要为了数据好看削掉辅助特色去堆DPS。

### 5. 覆盖面 vs 伤害深度的取舍

穿甲弹多列散射时DPS翻倍（8.7k→19.9k），但Vin果断否决——**失去了"穿甲"身份**。

**教训**：数值好看 ≠ 设计正确。武器特色 > DPS数字。宁可DPS低一点，也要保持"这把武器是干什么的"清晰可辨。渐进扩列（低级1列→高级4列）才是兼顾特色和成长的正解。

### 6. 乘区爆炸的排查顺序

当某武器DPS异常高时，按这个顺序排查：

1. **被动有没有×2以上？** → 最常见的元凶
2. **爽点有没有指数增长？** → CD型到极限时频率爆炸
3. **有没有多个乘区同时被buff？** → 频率+伤害+AOE三重叠加
4. **有没有缺少封顶/下限？** → CD无下限→射速趋近无穷

### 7. 平衡不是一次做完的

9轮迭代，从 13.7x 到 1.1x。每一轮都以为"差不多了"，跑完数据发现新问题。

**教训**：接受"需要多轮"这个事实，不要试图一轮调完。每轮有明确目标（修哪个乘区、解决哪个武器），改完验证，发现新问题下轮再改。

---

*"经验是最贵的数据库，但只有写下来才能复利。"* 🐾
