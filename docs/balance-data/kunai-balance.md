# 冰爆弹 (Kunai) 平衡记录

## 一、模型预测

### 设计参数
| 参数 | 值 | 来源 |
|------|-----|------|
| 无分支Lv1 基础DPS | **1.0** | 设计锚点 |
| 统一n值 | **1.25** | 设计值 |
| 被动乘区 | **×1.15/个** | 设计值 |
| basePct | **2.6** | 反推: DPS × interval / effHits = 1.0 × 6 / 2.33 |
| interval | 6000ms | WeaponBalanceConfig |
| effHits(无分支) | 2.33 | 沙盒实测: 直击+AOE命中~2.7砖×0.55系数 |
| aoeRadius | 1.1列宽 | WeaponBalanceConfig |
| aoeRadiusScale | 0.3/级 | WeaponBalanceConfig |
| splashDmg系数 | 0.55 | Kunai.js:275 |
| giant半径倍率 | ×1.5 | Kunai.js (从×2削弱) |
| 爽点 | CD缩短 base=6000, delta=-500/5级, 下限3000ms | WeaponShopDefs |

### 分支解锁节点
| ShopLv | 新增分支 | 累计点数 |
|--------|---------|---------|
| 1 | damage(10)+count(3)+aoe(4)+pierce(2)+pierceBlast(1) | 20 |
| 5 | +chain(2) | 22 |
| 10 | +splitBomb(3) | 25 |
| 18 | +giant(1) | **26(全满)** |

### 被动解锁节点
| ShopLv | 被动 | 效果 | 累计被动数 |
|--------|------|------|-----------|
| 6 | countNoPenalty | 多发不减伤 | 1 |
| 14 | burnExploit | 灼烧目标+50%伤 | 2 |
| 22 | burnChance | 20%概率灼烧(3s, 10%伤DOT) | 3 |
| 26 | pierceNoDecay | 穿透无衰减 | 4 |
| 30 | doomBarrage | 弹数×1.5 | 5 |

### 预测DPS
```
预测DPS = 1.0 × 1.25^(可用点数) × 局外成长(含被动)
局外 = 共享曲线 × 爽点 × 1.15^(被动数)
```

| ShopLv | 点数 | 分支乘数 | 被动数 | 局外(含被动) | 预测DPS |
|--------|------|---------|--------|-------------|---------|
| 1 | 20 | ×86.7 | 0 | ×1.0 | **87** |
| 10 | 25 | ×264.7 | 1 | ×3.5 | **926** |
| 20 | 26 | ×330.9 | 2 | ×11.9 | **3,938** |
| 30 | 26 | ×330.9 | 5 | ×54.3 | **17,968** |

---

## 二、调参历程

### Step 1: basePct 反推

**问题**：最初 basePct=12（原始值），后按"basePct=目标DPS"错误地改为 1.5。

**诊断过程**：
1. basePct=1.5 → Lv1 实测 DPS=44（含飞机501），武器占比仅 10% → 过低
2. 发现公式错误：`basePct ≠ DPS`，正确关系是 `DPS = basePct × effHits / interval`
3. 跑无分支Lv1沙盒实测 effHits=2.33（不是理论估的3.37）
4. 反推：basePct = 1.0 × 6 / 2.33 = **2.6**
5. 验证：basePct=2.6 无分支Lv1 DPS = **1.0** ✅

| basePct | 无分支Lv1 DPS | 状态 |
|---------|--------------|------|
| 1.5 | 0.25 | ❌ 过低 |
| 1.8 | 0.7 | ❌ 偏低 |
| **2.6** | **1.0** | ✅ 命中目标 |

### Step 2: 发现模型缺失被动乘区

**问题**：basePct=1.8 时 R1 数据 Lv30=17,885 vs 模型(无被动)=8,934 → +100% 偏差。

**诊断过程**：
1. 查 Lv20→Lv30 各来源倍率：aoe ×5.5（目标×3）→ 最初怀疑 aoe 分支
2. 排查 Lv20~30 之间解锁的被动：burnChance(Lv22) + pierceNoDecay(Lv26) + doomBarrage(Lv30)
3. 三个被动叠加约 ×2.3，模型完全未计入
4. **根因：模型缺少被动乘区**，不是 aoe 分支本身的问题

**修正**：模型增加 `passiveBonus = 1.15^(被动数)` 乘区。

### Step 3: giant 分支削弱

**问题**：basePct=2.6 + 被动乘区后，模型基本对齐，但 giant=×2 时 Lv10→Lv20 aoe 倍率仍偏高。

**分析**：
- giant 半径×2 = 面积×4，1个分支点带来全树最高单点收益
- Lv10(无giant) → Lv20(有giant) aoe 倍率 ×8.5（含局外×3）

**调整**：giant 半径 ×2 → **×1.5**（面积 ×4 → ×2.25）

---

## 三、最终实测数据

### R2: basePct=2.6, giant=×1.5, aoeRadiusScale=0.3

**测试条件**：纯武器(禁飞机), @10x, 120s, targetAlive=60, fullBranch=true

| ShopLv | 实测DPS | 模型预测 | 误差 |
|--------|---------|---------|------|
| 1 | 70.5 | 87 | **-19%** |
| 10 | 713 | 926 | **-23%** |
| 20 | 3,214 | 3,938 | **-18%** |
| 30 | 15,658 | 17,968 | **-13%** |

> 四个等级误差均在 ±25% 以内，方向一致(轻微偏低)，模型有效。
> 偏低原因：分支在实战中约 15~20% 效率折扣（属正常范围）。

**伤害来源分布：**

| ShopLv | 直击 | aoe | split | chain |
|--------|------|-----|-------|-------|
| 1 | 1,360(16%) | 7,104(84%) | — | — |
| 10 | 9,637(11%) | 50,832(59%) | 20,637(24%) | 4,403(5%) |
| 20 | 26,910(7%) | 246,572(64%) | 80,522(21%) | 31,730(8%) |
| 30 | 122,288(7%) | 1,360,383(72%) | 311,847(17%) | 84,473(4%) |

---

## 四、当前状态

✅ **basePct=2.6** — 无分支锚点 1.0 命中
✅ **giant=×1.5** — 从×2 削弱，Lv30 误差从+100%降至-13%
✅ **模型含被动乘区** — 四级误差均 <25%
✅ **aoeRadiusScale=0.3 保持不变** — 前期体验不受影响

### 最终配置值
```
basePct: 2.6
interval: 6000
aoeRadius: 1.1
aoeRadiusScale: 0.3
giant: ×1.5
splashDmg: ×0.55
爽点CD: base=6000, delta=-500, floor=3000
```

---

*初始记录: 2026-03-02*
*最终更新: 2026-03-02 — basePct=2.6, giant=×1.5, 模型含被动乘区*
