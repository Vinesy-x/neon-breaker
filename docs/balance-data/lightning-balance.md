# 闪电链 (Lightning) 平衡记录

## 一、模型预测

### 设计参数
| 参数 | 值 | 来源 |
|------|-----|------|
| 无分支Lv1 基础DPS | **1.0** | 设计锚点 |
| 统一n值 | **1.25** | 设计值 |
| 被动乘区 | **×1.15/个** | 设计值 |
| basePct | **0.91** | 满分支Lv1 标定（85.9 vs 模型87） |
| interval | 3800ms | WeaponBalanceConfig |
| baseChains | 3 | WeaponBalanceConfig |
| chainsPerLv(爽点) | +1链/5级 | WeaponShopDefs |
| 分支chains | +2链/点 | Lightning.js:85 |
| 链衰减 | **无** | 每跳等伤，charge使递增 |

### 分支解锁节点
| ShopLv | 新增分支 | 累计点数 |
|--------|---------|---------|
| 1 | damage(10)+chains(4)+charge(2)+shock(2)+echo(2) | 20 |
| 5 | +paralyze(2) | 22 |
| 10 | +storm(2) | 24 |
| 18 | +overload(1) | **25(全满)** |

### 被动解锁节点
| ShopLv | 被动 | 效果 | 累计被动数 |
|--------|------|------|-----------|
| 6 | shockMark | 被击砖+15%伤3秒 | 1 |
| 14 | residualField | 链尾电场DOT(15%伤×2s) | 2 |
| 22 | chainNoDecay | ⚠️ 空被动（闪电链本无衰减） | 3 |
| 26 | dualChain | 第2道闪电（理论×2） | 4 |
| 30 | thorGod | 60秒全屏闪电1次 | 5 |

### 预测DPS
```
预测DPS = 1.0 × 1.25^(可用点数) × 局外成长(含被动)
局外 = 共享曲线 × 爽点 × 1.15^(被动数)
```

| ShopLv | 点数 | 分支乘数 | 被动数 | 局外(含被动) | 预测DPS |
|--------|------|---------|--------|-------------|---------|
| 1 | 20 | ×86.7 | 0 | ×1.0 | **87** |
| 10 | 24 | ×211.8 | 1 | ×3.5 | **733** |
| 20 | 25 | ×264.7 | 2 | ×11.9 | **3,118** |
| 30 | 25 | ×264.7 | 5 | ×54.3 | **14,228** |

---

## 二、调参历程

### Step 1: basePct 标定

**问题**：闪电链伤害有 Math.floor 截断，basePct<2 时无分支每跳=1，DPS 不随 basePct 线性变化。

**解决**：改用满分支Lv1实测来标定（Vin指示，低等级允许较大偏差）。

| basePct | Lv1满分支DPS | vs模型87 |
|---------|-------------|---------|
| 1.59 | 151.2 | +74% |
| **0.91** | **85.9** | **-1.3%** ✅ |

---

## 三、最终实测数据

**测试条件**：纯武器(禁飞机), @10x, 120s, targetAlive=60, fullBranch=true

| ShopLv | 实测DPS | 模型预测 | 误差 | 段间倍率 |
|--------|---------|---------|------|---------|
| 1 | 85.9 | 87 | **-1.3%** ✅ | — |
| 10 | 868 | 733 | **+18%** ✅ | ×10.1 |
| 20 | 2,989 | 3,118 | **-4%** ✅ | ×3.4 |
| 30 | 11,269 | 14,228 | **-21%** ✅ | ×3.8 |

**伤害来源分布：**

| ShopLv | lightning | shock_arc | lightning_aoe | electric_field | lightning_thor |
|--------|-----------|-----------|---------------|----------------|----------------|
| 1 | 97% | 3% | — | — | — |
| 10 | 92% | 8% | — | — | — |
| 20 | 77% | 7% | 13% | 3% | — |
| 30 | 76.5% | 8% | 12.5% | 2.5% | 0.5% |

---

## 四、当前状态

✅ **basePct=0.91** — Lv1满分支误差-1.3%
✅ **四级误差均在±25%** — 无需调参
✅ **段间倍率** — Lv10→20=×3.4, Lv20→30=×3.8，均在容忍范围

### 已知问题（不影响平衡，记录备查）
- **chainNoDecay(Lv22)是空被动**：闪电链本无链衰减，此被动无实际效果
- **dualChain(Lv26)理论×2**：实战效率约×1.5~1.7（目标重叠损失），当前结果可接受
- **thorGod(Lv30)贡献极低**：60秒1次全屏≈0.5%DPS，几乎是视觉效果

### 最终配置值
```
basePct: 0.91
interval: 3800
baseChains: 3
chainsPerLv: +1/5级
链衰减: 无
charge: +25%/跳/点
```

---

*记录: 2026-03-02 阿喵*
