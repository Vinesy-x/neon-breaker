# 闪电链 (Lightning) 平衡记录

## 一、模型预测

### 设计参数
| 参数 | 值 | 来源 |
|------|-----|------|
| 无分支Lv1 基础DPS | **1.0** | 设计锚点 |
| 统一n值 | **1.25** | 设计值 |
| 被动乘区 | **×1.15/个** | 设计值 |
| basePct | **0.83** | Lv1满分支标定 |
| interval | 3800ms | WeaponBalanceConfig |
| baseChains | 3 | WeaponBalanceConfig |
| chainsPerLv(爽点) | +1链/5级 | WeaponShopDefs |
| 分支chains | +2链/点 | Lightning.js |
| 链衰减 | **无** | 每跳等伤，charge使递增 |
| 伤害精度 | 保留1位小数 | Math.round(x*10)/10 |

### 分支解锁节点
| ShopLv | 新增分支 | 累计点数 |
|--------|---------|---------|
| 1 | damage(10)+chains(4)+charge(2)+shock(2)+echo(2) | 20 |
| 5 | +paralyze(2) | 22 |
| 10 | +storm(2) | 24 |
| 18 | +overload(1) | **25(全满)** |

### 被动解锁节点
| ShopLv | 被动 | 效果 | 累计被动数 |
|--------|------|------|-----------|
| 6 | shockMark | 被击砖+15%伤3秒 | 1 |
| 14 | residualField | 链尾电场DOT(15%伤×2s) | 2 |
| 22 | chainNoDecay | ⚠️ 空被动（闪电链本无链衰减） | 3 |
| 26 | dualChain | 第2道闪电（实战~×1.6） | 4 |
| 30 | thorGod | 60秒全屏闪电1次 | 5 |

### 预测DPS
| ShopLv | 点数 | 分支乘数 | 被动数 | 局外(含被动) | 预测DPS |
|--------|------|---------|--------|-------------|---------|
| 1 | 20 | ×86.7 | 0 | ×1.0 | **87** |
| 10 | 24 | ×211.8 | 1 | ×3.5 | **733** |
| 20 | 25 | ×264.7 | 2 | ×11.9 | **3,118** |
| 30 | 25 | ×264.7 | 5 | ×54.3 | **14,228** |

---

## 二、调参历程

### Step 1: Math.floor → 保留1位小数

**问题**：basePct<2 时 Math.floor 将小数截断为0/1，低等级DPS不随basePct线性变化。

**修改**：`Math.floor(x)` → `Math.round(x*10)/10`，影响2处：
- Lightning.js:105 — 链伤害计算
- Lightning.js:172 — 电场DOT伤害

### Step 2: basePct 标定

| basePct | Lv1满分支DPS | vs模型87 | 说明 |
|---------|-------------|---------|------|
| 1.28(Math.round) | 134 | +54% ❌ | floor→round后DPS大涨 |
| **0.83** | **72.2** | **-17%** ✅ | 最终值 |

---

## 三、最终实测数据

**测试条件**：纯武器(禁飞机), @10x, 120s, targetAlive=60, fullBranch=true

| ShopLv | 实测DPS | 模型预测 | 误差 | 段间倍率 |
|--------|---------|---------|------|---------|
| 1 | 72.2 | 87 | **-17%** ✅ | — |
| 10 | 809 | 733 | **+10%** ✅ | ×11.2 |
| 20 | 2,731 | 3,118 | **-12%** ✅ | ×3.4 |
| 30 | 11,827 | 14,228 | **-17%** ✅ | ×4.3 |

**伤害来源分布(Lv30)：**
- lightning(主链): 75.5%
- lightning_aoe(storm): 13.4%
- shock_arc: 8.0%
- electric_field(被动): 2.8%
- lightning_thor(被动): 0.4%

---

## 四、当前状态

✅ **basePct=0.83** — 四级误差均在±17%
✅ **Math.floor→Math.round(x*10)/10** — 解决低数值截断
✅ **段间倍率** — Lv10→20=×3.4, Lv20→30=×4.3

### 已知问题（不影响平衡，记录备查）
- **chainNoDecay(Lv22)是空被动**：闪电链本无链衰减
- **dualChain(Lv26)实战~×1.6**（非理论×2，目标重叠损失）
- **Lv20→30=×4.3 略超容忍上限**：dualChain贡献，可接受

### 最终配置值
```
basePct: 0.83
interval: 3800
baseChains: 3
chainsPerLv: +1/5级
链衰减: 无
伤害精度: Math.round(x*10)/10
```

---

*记录: 2026-03-02 阿喵*
