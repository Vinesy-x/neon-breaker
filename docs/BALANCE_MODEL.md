# 武器数值平衡模型设计方法论

> 作者：阿喵 × Vin | 项目：无限飞机
> 创建：2026-02-28

---

## 一、核心理念

**数值不是拍脑袋，是一套可验证的数学模型。**

目标：任何武器的强度都能用同一把"尺子"量出来，新增武器时套公式就能得到合理初始值，而不是反复试错。

---

## 二、建模步骤（按顺序执行）

### Step 1：定义基准单位

**先定"1"是什么。**

在本项目中：
- **基准伤害单位** = `baseAttack`（玩家基础攻击力，随永久升级成长）
- **基准时间单位** = 1秒
- **基准目标数** = 1个砖块

所有武器的伤害最终都换算成：**每秒对每个目标造成多少个 baseAttack 的伤害**。

```
标准DPS = basePct × hitCount × efficiency / (interval / 1000)
```

### Step 2：定义节奏锚点

**先定CD，再定伤害。** 不是反过来。

因为CD决定了"手感"——玩家多久能看到一次武器释放。这是体验层面的，不应该被数值倒推。

```
节奏锚点（本项目）：
┌─────────────┬────────┬──────────────────┐
│ 频率档位     │ CD范围  │ 设计感受          │
├─────────────┼────────┼──────────────────┤
│ 超高频(tick) │ <1s    │ 持续存在感，细水长流 │
│ 高频         │ 3~4s   │ 频繁释放，节奏紧凑  │
│ 基准         │ 5~7s   │ 标准节奏，有等待感  │
│ 中低频       │ 7~9s   │ 单发需有存在感     │
│ 低频         │ 10~12s │ 每次释放是个"事件"  │
│ 超低频(大招) │ 12~15s │ 战略性使用，期待感  │
└─────────────┴────────┴──────────────────┘

核心公式：4把武器 × 平均6秒CD = 每1.5秒释放1个武器
```

**为什么先定CD？** 因为CD改了，整个游戏节奏都变了。伤害可以微调，CD不能乱动。

### Step 3：定义DPS预算

**每个武器分配相同的"DPS预算"，差异体现在分配方式上。**

```
DPS预算 = 目标有效DPS（对标准局面的总贡献）

标准局面定义（打砖块布局，7列）：
- 常规密度：屏幕上 20~30 个砖块（7列×3~4行）
- 对抗高峰：屏幕上 40~60 个砖块（7列×6~8行，紧凑排列）
- 平均每列 4~6 个砖块
- 砖块HP = baseHP × chapterScale（第1章约1~2）
- 砖块持续从顶部刷新下移，接近危险线时密度最高

DPS预算基于"常规密度"计算，高峰期AOE武器自然获得更多收益（这是设计意图）。
```

**DPS预算不是"单体DPS相同"，而是"对局面的贡献相同"。**

这意味着：
- AOE武器单体DPS低，但命中多 → 总贡献高
- 单体武器DPS高，但只打一个 → 总贡献相当
- 控制武器DPS低，但提供减速/冻结 → 用"等效DPS"补偿

### Step 4：建立换算公式

**关键：定义每个武器的"有效倍率"。**

```
有效DPS = basePct × 有效倍率 / (CD秒)

有效倍率 = 命中数 × 衰减系数 × 机制系数
```

各武器的有效倍率计算：

```
寒冰弹（AOE）:
  命中数 = 常规4~5个，高峰6~8个（AOE范围+砖块密集）
  取平均 = 5个
  机制系数 = 1.0（直接伤害）
  有效倍率 = 5.0

闪电链（跳链）:
  命中数 = 3链（密集时每链必中不同目标）
  衰减系数 = 1 + 0.9 + 0.81 = 2.71（每跳-10%）
  机制系数 = 1.1（自动瞄准加分：无miss、优先危险目标）
  有效倍率 = 2.71 × 1.1 = 2.98

穿甲弹（穿透）:
  命中数 = 平均4~5（每列4~6个砖，5穿基本打满）
  衰减系数 = 1 + 0.8 + 0.64 + 0.51 + 0.41 = 3.36（每穿-20%）
  机制系数 = 0.7（只打一列，位置受限，但高密度时穿满）
  有效倍率 = 3.36 × 0.7 = 2.35

寒冰发生器（防御碰撞）:
  命中数 = 2墙 × 持续碰撞（高密度时多个砖块同时撞墙）
  机制系数 = 0.5（被动触发，不可控，但高密度时收益大增）
  控制等效 = +0.5（冰缓减速+挡住砖块=间接保命DPS）
  有效倍率 = 特殊（墙HP型，不适用标准公式）
```

### Step 5：反推 basePct

**有了CD、有效倍率、目标DPS，反推basePct。**

```
目标有效DPS = 4.0（所有武器的平衡锚点）

basePct = 目标DPS × CD秒 / 有效倍率
```

**完整推导表（目标有效DPS = 4.0）**

```
武器       │ CD  │ 机制说明                          │ 有效倍率 │ basePct │ 验证DPS
──────────┼─────┼──────────────────────────────────┼─────────┼────────┼────────
寒冰弹     │ 6s  │ AOE 1.2列=命中8个, 直接伤害        │ 8.00   │ 3.0    │ 4.00 ✅
闪电链     │ 4s  │ 3链×衰减(2.71)×瞄准(1.1)          │ 2.98   │ 5.0    │ 3.73 ✅
穿甲弹     │ 8s  │ 5穿×衰减(3.36)×单列(0.7)          │ 2.35   │ 14.0   │ 4.12 ✅
轰炸机     │ 12s │ 4弹×每弹2命中                      │ 8.00   │ 6.0    │ 4.00 ✅
白磷弹     │ 8s  │ DOT 3目标×10tick×效率(0.35)        │ 10.50  │ 3.0    │ 3.94 ✅
离子射线   │ 7s  │ 单目标×标记(1.3)×占用率(2s/7s)      │ 0.37   │ 75.0   │ 3.98 ✅
回旋刃     │ 10s │ 25tick×1.5命中×不稳定(0.1)         │ 3.75   │ 11.0   │ 4.13 ✅
无人机     │ 0.5s│ 常驻2台×每tick 1命中               │ 2.00   │ 1.0    │ 4.00 ✅
寒冰发生器  │ 10s │ 墙HP型，被动碰撞                   │ 特殊    │ 12.0   │ -
奇点引擎   │ 14s │ %HP+引力，特殊机制                  │ 特殊    │ 12.0   │ -
```

**公式：basePct = 目标DPS × CD / 有效倍率**

注意：
- 离子射线basePct=75看似很高，是因为只有28%时间在输出且只打单目标
- 回旋刃basePct=11是每tick伤害，但25次tick×1.5命中总伤巨大
- 持续型武器的basePct含义不同于瞬发型，不能直接对比绝对值

### Step 6：定义成长曲线

**basePct 是Lv1的值。后续通过两条曲线成长：**

```
实际DPS = basePct × shopMultiplier × branchMultiplier

1. 外部养成（商店等级 1~30）:
   shopMultiplier = 1.0 + Σ(dmgMultPerLevel)
   - Lv1~5:  每级 +10%
   - Lv6~10: 每级 +15%
   - Lv11~15: 每级 +20%
   - Lv16~20: 每级 +25%
   - Lv21~30: 每级 +30%
   → 满级 shopMult ≈ 6.5倍

2. 战斗内升级（分支 damage 0~10）:
   branchMultiplier = 1.0 + damageLv × 0.5
   → 满级 branchMult = 6.0倍

3. 总成长幅度:
   满配DPS = basePct × 6.5 × 6.0 = basePct × 39倍
```

**这意味着：Lv1的DPS占满配的2.5%，成长空间巨大。**

### Step 7：验证极端情况

建模完成后，必须验证以下场景：

```
□ 第1章Lv1：武器能正常击杀砖块吗？（不能太弱无感）
□ 第1章满配：会不会秒杀一切？（不能碾压失去挑战）
□ 第50章Lv1：新武器能活下来吗？（不能完全没用）
□ 第100章满配：最终BOSS难度合理吗？
□ 4把武器全满 vs 单武器满：差距合理吗？（期望3~4倍）
□ 最强组合 vs 最弱组合：差距<2倍？（否则有"标准答案"）
```



---

## 二.6、范围单位体系：以列宽为1

### 为什么用列宽做单位

像素值不直观（28px的AOE大吗？），用列宽做单位一看就知道：
- r=1 → 覆盖1列宽的圆 → "打到旁边一列"
- r=1.5 → 覆盖1.5列宽 → "打到左右各多半列"

### 关键参数（375px屏幕，7列）

```
列宽(含间距) = 53px
砖块高度 = 20px
宽高比 = 2.6:1 → 砖块很扁，AOE纵向命中行数远多于列数
1列宽 = 53px = 2.65个砖块高度
```

### AOE半径 → 命中砖块对照表（通用基准表）

此表适用于所有范围型武器（寒冰弹、轰炸机、白磷弹、奇点引擎等）。
任何涉及AOE范围的数值设计，以此表为准。

```
┌────────────┬───────┬───────────────┬──────────────┬──────────────┐
│ 半径(列宽)  │ 像素   │ 覆盖范围       │ 密集命中(60砖) │ 常规命中(30砖) │
├────────────┼───────┼───────────────┼──────────────┼──────────────┤
│ 0.5        │ 27px  │ ~1列×3行       │ 2            │ 1            │
│ 0.8        │ 42px  │ ~1.6列×4行     │ 5            │ 3            │
│ 1.0        │ 53px  │ ~2列×5行       │ 7            │ 5            │
│ 1.2 ⭐     │ 64px  │ ~2.4列×6行     │ 10           │ 7            │
│ 1.5        │ 80px  │ ~3列×8行       │ 16           │ 10           │
│ 1.8        │ 95px  │ ~3.6列×10行    │ 23           │ 15           │
│ 2.0        │ 106px │ ~4列×11行      │ 28           │ 18           │
│ 2.5        │ 133px │ ~5列×13行      │ 44           │ 29           │
│ 3.0        │ 159px │ ~6列×16行      │ 64           │ 42           │
└────────────┴───────┴───────────────┴──────────────┴──────────────┘

⭐ 1.2列 = 寒冰弹基础AOE（密集10个/常规7个）

密集 = 对抗高峰40~60砖，常规 = 日常推进20~30砖
命中数 = π×r²px / (列宽×砖高) × 填充率(密集85%/常规55%)
```

**使用方法：** 设计任何范围武器时，查此表确定有效命中数，
再代入DPS公式 `basePct = 目标DPS × CD / 有效命中数`。
不要凭直觉估命中数。

### 各武器范围参数（统一为列宽单位，查上表得命中数）

```
武器        │ 类型      │ 半径(列宽) │ 密集命中 │ 常规命中 │ DPS用值
──────────┼─────────┼──────────┼────────┼────────┼───────
寒冰弹 AOE  │ 圆形AOE   │ 1.2列     │ 10     │ 7      │ 8（取均值）
轰炸机 单弹 │ 圆形AOE   │ 0.5列     │ 2      │ 1      │ 2×4弹=8
白磷弹 燃区 │ 持续DOT区  │ 0.6列     │ 3      │ 2      │ 3（持续tick）
闪电链      │ 跳链      │ 全屏      │ 3链    │ 3链    │ 2.98（含衰减）
穿甲弹      │ 纵向穿透   │ 1列宽     │ 5~6    │ 3~4    │ 3.36（含衰减）
寒冰发生器   │ 碰撞墙    │ 1列/墙    │ 该列全部 │ -      │ 特殊
奇点引擎    │ 引力场    │ 2.0列     │ 28     │ 18     │ 特殊(%HP)
```

---

## 三、控制变量法则

**同一时间只调一个维度。**

武器强度由以下维度决定：
```
1. basePct（基础伤害）    — 决定下限
2. interval（CD）         — 决定节奏
3. 有效倍率（命中数×机制） — 决定上限
4. 成长曲线              — 决定养成深度
```

调平衡时的优先级：
1. **CD不动**（节奏是体验根基）
2. **调basePct**（最安全，只影响数值不影响手感）
3. **调有效倍率**（改机制参数：链数、穿透数、AOE范围）
4. **最后才动成长曲线**（影响全局经济）

---

## 四、DPS预算分配表（模板）

用于新增武器时快速定值：

```
目标有效DPS: 4.0 × baseAttack / 秒

新武器设计清单：
1. 确定定位（AOE/单体/控制/持续）
2. 选CD档位（参考节奏锚点表）
3. 设计机制 → 计算有效倍率
4. basePct = 4.0 × CD秒 / 有效倍率
5. 填入 WeaponBalanceConfig.js
6. 实机测试 → 微调 basePct ±20% 以内
```

**如果微调超过±20%还不对，说明有效倍率算错了，回Step 4重算。**

---

## 二.5、持续型武器的DPS模型

### 瞬发型 vs 持续型

武器分两大类，DPS计算方式完全不同：

```
┌──────────┬───────────────────────────────────────┐
│ 瞬发型    │ 发射→命中→进入冷却                      │
│          │ DPS = basePct × hitCount / CD          │
│          │ 代表：寒冰弹、闪电链、穿甲弹、轰炸机、白磷弹 │
├──────────┼───────────────────────────────────────┤
│ 持续型    │ 发射→持续输出duration→进入冷却            │
│          │ DPS = tickDmg × tickCount / fullCycle   │
│          │ 代表：离子射线、回旋刃、冰霜、无人机、奇点引擎│
└──────────┴───────────────────────────────────────┘
```

### 关键概念：完整周期（Full Cycle）

```
瞬发型: fullCycle = interval（CD即完整周期）
持续型: fullCycle = duration + cooldown

其中 cooldown = interval - duration（CD从释放结束后开始计）
或    cooldown = interval（CD从释放开始计，含duration）

本项目采用后者：interval = 从释放开始到下次可释放的总时间
所以：fullCycle = interval（已包含duration）
```

### 持续型DPS计算

```
持续型武器的实际输出 = duration期间的总伤害 / fullCycle

tickDmg = basePct × baseAttack × 各种倍率
tickCount = duration / tickInterval
totalDmg = tickDmg × tickCount
DPS = totalDmg / (interval / 1000)
```

### 各持续型武器详细模型

#### 离子射线（射击型持续）
```
释放时间: baseBeamSec = 2s（爽点每5级+0.3s）
tick间隔: ~每帧（连续射击）
完整周期: interval = 7s
有效输出时间: 2s / 7s = 28.6%

DPS = basePct × (beamSec / interval) × 标记增伤
    = 2.8 × (2/7) × 1.3（平均3层标记+24%）
    ≈ 1.04 × baseAttack/秒（偏低！但标记叠满后爆发极高）

爽点成长: beamSec 2→3.5s（满级）→ 输出占比28%→50% → DPS翻倍
```

#### 回旋刃（存活型持续）
```
存活时间: ~5s基础（duration分支每级+2s）
tick间隔: 200ms
完整周期: interval = 10s
有效输出时间: 5s / 10s = 50%

tickCount = 5000 / 200 = 25次
每次命中: ~1.5个目标（弹墙扫过）
DPS = basePct × 25 × 1.5 / (10s)
    = 0.4 × 25 × 1.5 / 10
    = 1.5 × baseAttack/秒

爽点成长: duration 5→8s → DPS×1.6
```

#### 寒冰发生器（被动碰撞型持续）
```
冰墙存活: 直到HP耗尽（被动消耗，不受时间限制）
墙数: 2基础
完整周期: interval = 10s（补墙间隔）
特殊: 墙HP = basePct × baseAttack，伤害 = 砖块撞墙消耗的HP

DPS取决于砖块下移速度和密度（不可控）
等效DPS ≈ basePct × wallCount × collisionRate / interval
    = 12 × 2 × 0.3 / 10 ≈ 0.72（保守估计）

实际价值: 防御收益（挡住砖块）远大于DPS贡献
```

#### 奇点引擎（技能型持续）
```
持续时间: baseDuration = 5s（奇点分支每级+1.5s）
tick间隔: 400ms
完整周期: interval = 14s
有效输出时间: 5s / 14s = 35.7%

tickCount = 5000 / 400 = 12.5次
引力伤害: 基于吸入砖块的%HP（特殊机制）
DPS = (basePct/100 × %HP伤害 + 事件视界伤害) × tickCount / 14
```

#### 无人机（常驻型持续）
```
特殊: 无人机一旦部署就常驻，不是CD释放型
interval = 500ms 是激光tick间隔（不是冷却）
实际: 永久在场，每500ms对目标造成一次伤害

DPS = basePct × droneCount / (tickInterval / 1000)
    = 0.4 × 2 / 0.5
    = 1.6 × baseAttack/秒（稳定持续输出）
```

### 持续型武器的平衡要点

```
1. 持续型的"感知DPS"低于实际DPS
   → 玩家觉得"没伤害"，因为伤害分散在duration内
   → 需要视觉反馈补偿（飘字频率、特效密度）

2. duration是核心成长维度
   → 瞬发型靠basePct成长
   → 持续型靠duration成长（DPS随时长线性增长）
   → 爽点属性优先给duration，而非basePct

3. 占用率（duration/interval）决定上限
   → 占用率>60% 的武器会"感觉一直在放"，节奏感消失
   → 占用率<30% 的武器像瞬发型，持续感弱
   → 最佳区间: 30%~50%

4. 持续型的basePct应该低于同CD瞬发型
   → 因为持续型有多次命中机会
   → 但要保证"单次tick伤害"可见（>0.3 baseAttack）
   → 否则飘字太小玩家无感
```

### 持续时间成长对照表

```
| 武器       | 基础duration | 满级duration | 占用率变化     |
|-----------|-------------|-------------|--------------|
| 离子射线   | 2s          | 5s(+3s)     | 28%→71%（爆发感） |
| 回旋刃    | 5s          | 11s(+6s)    | 50%→100%+     |
| 奇点引擎   | 5s          | 8s(+3s)     | 36%→57%       |
| 寒冰发生器 | 持续到碎裂    | —           | 100%（永久在场）  |
| 无人机     | 永久在场      | —           | 100%          |
```


---

## 五、爽点属性与DPS的关系

商店每5级的爽点属性（CD缩短/链数增加/穿透增加等）**不计入基础DPS预算**，它们是"额外奖励"。

```
爽点带来的DPS提升预期：
- CD缩短型：每档 -5~10% CD → DPS +5~10%
- 命中数增加型：每档 +1命中 → DPS +15~25%
- 持续时间增加型：每档 +0.5s → DPS +10~15%

满级爽点总提升：约 +40~60% DPS（在shopMult之上）
```

这部分是"隐性战力"，让玩家觉得"升级有用但不知道具体多强"，增加养成探索感。

---

## 六、实操检查清单

每次调数值前过一遍：

```
□ 我在改哪个维度？（basePct/CD/机制参数/成长曲线）
□ 只改配置文件，不碰逻辑代码
□ 改完后算一下有效DPS，是否在目标±20%以内
□ 是否破坏了CD节奏锚点
□ 是否影响其他武器的相对强度
□ 极端情况验证（第1章/第100章）
```

---

*此文档随项目迭代持续更新。*
