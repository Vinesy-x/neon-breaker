# 无限飞机 v2 - 游戏设计文档

> 版本：v2.0 草案 | 更新日期：2026-02-20

---

## 一、核心概念

**一句话**：赛博朋克章节制射击肉鸽，打飞机操控 + 多样砖块怪物 + Survivor式Build + Boss战通关。

**平台**：微信小游戏
**技术栈**：纯 JS + Canvas 2D + CommonJS（零依赖）
**美术风格**：深空 + 霓虹色，全程代码绘制
**音效**：WebAudio 合成，零资源

---

## 二、游戏流程

```
标题画面 → 章节选择（1~100） → 进入章节
→ 砖块持续推进（难度节奏曲线） → 经验升级 → 三选一Build
→ ~10分钟后 Boss 出现 → 击败Boss = 通关
→ 结算（金币奖励） → 返回章节选择
```

### 章节选择界面
- 线性解锁：通关第N章才能进第N+1章
- 已通关章节可重复刷（刷金币）
- 每章显示：章节号、Boss图标、最高分、通关标记
- 滚动列表，当前最高章节高亮

---

## 三、章节内玩法

### 操控
- 手指拖拽 = 发射器左右移动
- 发射器自动往上射子弹
- 单指操作

### 砖块推进
- 砖块从屏幕顶部持续生成并缓慢下移
- **没有明显波次分割**，但难度有节奏曲线（见下方）
- 砖块到达危险线 = Game Over（本章失败）

### 难度节奏曲线（每章~10分钟）
章节内按时间推进，难度呈**锯齿波**节奏——逐渐加压，短暂喘息，再加压更猛：

| 时间段 | 阶段 | 节奏 | 砖块特征 |
|--------|------|------|----------|
| 0:00~1:30 | 热身 | 轻松 | 纯普通砖块，1HP，空洞多 |
| 1:30~3:00 | 升温 | 渐紧 | 混入快速砖块，HP升至1-2 |
| 3:00~3:30 | 喘息 | 放松 | 短暂减少密度，给玩家消化Build |
| 3:30~5:00 | 加压 | 偏紧 | 阵型砖块登场，HP 2-3，密度增加 |
| 5:00~5:30 | 喘息 | 放松 | 短暂缓和 |
| 5:30~7:00 | 高压 | 紧张 | 护盾/分裂砖块出现，HP 3-4 |
| 7:00~7:30 | 喘息 | 放松 | 最后的喘息 |
| 7:30~9:00 | 冲刺 | 最紧 | 隐身/治愈砖块全出，HP 4-5，密度最高 |
| 9:00~9:30 | 清场 | 缓和 | 砖块减少，为Boss腾场地 |
| 9:30~10:00+ | Boss | 决战 | Boss登场，不再生成普通砖块 |

> 每个喘息期~30秒，让玩家感受到"一波过了"的爽感，同时升级选择通常在这时弹出。

### 章节难度缩放（1~100章）
所有章节内部节奏曲线一致，差异在**数值缩放**：

| 参数 | 第1章 | 第10章 | 第50章 | 第100章 |
|------|-------|--------|--------|---------|
| 砖块基础HP倍率 | 1.0x | 1.5x | 3.0x | 6.0x |
| 砖块下移速度 | 0.12 | 0.16 | 0.24 | 0.35 |
| 生成间隔 | 2500ms | 2200ms | 1800ms | 1400ms |
| 空洞概率 | 15% | 12% | 8% | 4% |
| Boss HP倍率 | 1.0x | 2.0x | 5.0x | 12.0x |
| 金币奖励 | 50 | 120 | 350 | 800 |

公式参考：
- HP倍率 = 1.0 + (章节-1) × 0.05
- 下移速度 = 0.12 + (章节-1) × 0.0023
- 生成间隔 = 2500 - (章节-1) × 11（最低1400）
- 空洞概率 = 0.15 - (章节-1) × 0.0011（最低0.04）

---

## 四、砖块类型（7种）

### 1. 普通砖块 🟦
- **行为**：无特殊，静态下移
- **颜色**：随机霓虹色（青/粉/绿/黄）
- **HP**：按章节和时间段缩放
- **首次出现**：第1章

### 2. 快速砖块 🟧
- **行为**：下移速度 × 2.0
- **视觉**：橙色 + 向下箭头标记 + 速度拖影
- **HP**：普通砖块的 80%（脆但快）
- **首次出现**：第1章（1:30后混入）
- **设计意图**：制造紧迫感，考验反应

### 3. 阵型砖块 🟪
- **行为**：以固定队形出现（V字/菱形/横排/斜线/箭头）
- **视觉**：紫色，同一阵型内颜色统一
- **HP**：正常
- **首次出现**：第1章（3:30后登场）
- **阵型列表**：
  - V字形（7个）
  - 菱形（5个）
  - 满排横线（7个）
  - 双排交错（14个）
  - 箭头（9个）
- **设计意图**：增加视觉多样性，部分阵型需要策略性优先击破

### 4. 护盾砖块 🛡️
- **行为**：外层有1层护盾，护盾吸收第一次伤害（无论伤害多高）后破碎，之后正常受伤
- **视觉**：白色半透明外框 + 破碎动画
- **HP**：正常（护盾额外）
- **首次出现**：第2章（高压阶段），第5章起从升温阶段就出现
- **设计意图**：降低爆发Build的碾压感，需要多次命中

### 5. 分裂砖块 💎
- **行为**：摧毁后裂成2个小砖块（各1HP，宽度减半），小砖块继续下移
- **视觉**：青绿色 + 裂纹纹理 + 分裂时粒子爆发
- **HP**：正常
- **首次出现**：第3章（高压阶段），第8章起从加压阶段出现
- **设计意图**：增加砖块总量压力，让玩家感觉"打不完"

### 6. 隐身砖块 👻
- **行为**：每2秒切换一次显隐状态，隐身时完全无敌（子弹穿过）
- **视觉**：半透明闪烁，隐身时渐隐（alpha渐变）
- **HP**：普通砖块的 70%（补偿无敌时间）
- **首次出现**：第5章（冲刺阶段），第15章起从高压阶段出现
- **设计意图**：节奏打断，玩家需要等待窗口期集火

### 7. 治愈砖块 ❤️
- **行为**：每3秒给周围（上下左右相邻）砖块回复1HP，自身不回血
- **视觉**：红色 + 脉冲波纹（回血时向外扩散绿色光环）
- **HP**：普通砖块的 60%（需要优先击杀）
- **首次出现**：第8章（冲刺阶段），第20章起从高压阶段出现
- **设计意图**：战术优先级——必须先打掉治愈砖块，否则前线永远清不干净

### 砖块出现时间线（按章节推进）

| 章节 | 新增砖块类型 | 说明 |
|------|-------------|------|
| 1 | 普通、快速、阵型 | 基础三件套 |
| 2 | 护盾 | 高压阶段出现 |
| 3 | 分裂 | 高压阶段出现 |
| 5 | 隐身 | 冲刺阶段出现 |
| 8 | 治愈 | 冲刺阶段出现 |
| 10+ | 全类型混合 | 各阶段均可出现 |
| 20+ | 精英变体 | 高HP+双特性（如护盾+快速） |

---

## 五、Boss系统（5种类型，20轮循环）

每章末尾出现Boss，5种类型按顺序循环：
- 第1/6/11/16/.../96章 → 冲锋者
- 第2/7/12/17/.../97章 → 护盾卫士
- 第3/8/13/18/.../98章 → 召唤师
- 第4/9/14/19/.../99章 → 激光炮台
- 第5/10/15/20/.../100章 → 幽影刺客

每轮循环数值递增，同时获得增强机制。

### Boss 1：冲锋者 (Charger) 🔴
- **造型**：宽体红色装甲砖块
- **核心机制**：周期性加速冲向危险线
  - 正常状态：缓慢左右移动
  - 蓄力（1.5秒闪烁警告）→ 加速下冲一段距离 → 停顿 → 返回原位
  - 冲锋路径上的子弹被弹开
- **弱点**：停顿期间受到双倍伤害
- **HP**：基础300 × 章节倍率
- **循环增强**：
  - 第2轮起：冲锋后留下火焰地带（持续2秒伤害子弹）
  - 第3轮起：冲锋变为三路扩散冲
  - 第4轮起：蓄力时间缩短至1秒

### Boss 2：护盾卫士 (Guardian) 🔵
- **造型**：蓝色方块 + 旋转护盾环
- **核心机制**：旋转护盾挡住正面攻击
  - 2块弧形护盾绕Boss旋转
  - 护盾可被打碎（各有独立HP），碎后8秒再生
  - 必须从护盾缝隙射入才能伤到本体
- **弱点**：护盾全碎后5秒窗口期
- **HP**：基础350 × 章节倍率，护盾各80 × 章节倍率
- **循环增强**：
  - 第2轮起：护盾增加到3块
  - 第3轮起：护盾碎裂时反射一圈弹幕
  - 第4轮起：护盾再生缩短至5秒

### Boss 3：召唤师 (Summoner) 🟣
- **造型**：紫色核心 + 悬浮碎片环绕
- **核心机制**：定期召唤小砖块增援
  - 每5秒召唤一行普通砖块（从Boss两侧生成）
  - 召唤时Boss获得2秒护盾（无敌）
  - 召唤的砖块打掉也给经验
- **弱点**：不在召唤时防御力为零，是输出窗口
- **HP**：基础250 × 章节倍率（低HP，但拖时间）
- **循环增强**：
  - 第2轮起：召唤间隔缩短至4秒
  - 第3轮起：偶尔召唤护盾砖块或快速砖块
  - 第4轮起：召唤两行

### Boss 4：激光炮台 (Laser Turret) 🟡
- **造型**：黄色三角 + 充能核心
- **核心机制**：充能后发射垂直激光扫屏
  - 左右缓慢移动
  - 每8秒充能（2秒警告线）→ 发射全屏宽激光（1.5秒持续）
  - 激光范围内的子弹被消除
  - 玩家发射器在激光范围内不会死，但子弹打不出去
- **弱点**：充能期间移动停止，头顶充能核心受到三倍伤害
- **HP**：基础400 × 章节倍率
- **循环增强**：
  - 第2轮起：激光后留下灼烧带（3秒内该区域子弹消融）
  - 第3轮起：双炮管，交替发射
  - 第4轮起：充能间隔缩短至6秒

### Boss 5：幽影刺客 (Phantom) ⚪
- **造型**：白色半透明体 + 残影
- **核心机制**：瞬移 + 突袭
  - 每4秒消失 → 随机位置重新出现（带闪现特效）
  - 出现瞬间向发射器位置释放一排快速砖块
  - 消失期间完全无敌
  - 移动速度比其他Boss快50%
- **弱点**：出现后1秒内处于"实体化"状态，受到双倍伤害
- **HP**：基础280 × 章节倍率
- **循环增强**：
  - 第2轮起：瞬移后留下残影（残影1HP，不打掉会挡子弹）
  - 第3轮起：释放砖块变为分裂砖块
  - 第4轮起：瞬移间隔缩短至3秒

### Boss HP缩放
```
Boss基础HP × (1.0 + (章节-1) × 0.12)
```
第1章Boss ≈ 250~400 HP
第50章Boss ≈ 1750~2800 HP
第100章Boss ≈ 3250~5200 HP

---

## 六、经验 & 升级系统

### 经验获取
- **唯一来源**：打掉砖块
- 每砖基础经验 = 3 + HP × 1
- 特殊砖块额外经验：护盾+2，分裂+1（主体），隐身+3，治愈+4
- Boss每次受击给经验（按伤害量）
- 经验球飞向经验条的视觉保留

### 升级节奏（各章节一致）
目标：10分钟内升约 **8~10次**，平均每 60~75秒升一次

| 等级 | 累计经验 | 升级所需 | 预计时间 |
|------|---------|---------|---------|
| 1→2 | 80 | 80 | ~0:45 |
| 2→3 | 200 | 120 | ~1:30 |
| 3→4 | 370 | 170 | ~2:30 |
| 4→5 | 600 | 230 | ~3:30 |
| 5→6 | 900 | 300 | ~4:45 |
| 6→7 | 1280 | 380 | ~6:00 |
| 7→8 | 1750 | 470 | ~7:15 |
| 8→9 | 2320 | 570 | ~8:30 |
| 9→10 | 3000 | 680 | ~9:45 |

公式：升级所需 = 80 + (等级-1) × 50 + (等级-1)² × 5

> 章节难度缩放时，砖块HP同步提高 = 单砖经验同步提高，保持升级节奏一致。

### 升级选择
- 三选一卡片（保留现有UI）
- 保证至少1个武器选项
- 新武器优先级 > 升级已有 > 基础强化
- 每章从零开始Build

---

## 七、武器系统（保留现有6大武器）

与v1完全一致，不再重复：
- 等离子刃（环绕）→ 量子旋涡
- 烈焰涌动（波纹）→ 炼狱风暴
- 链式闪电（锁定）→ 雷神之怒
- 追踪导弹（追踪）→ 核弹洗地
- 激光射线（射线）→ 死亡射线
- 冰霜领域（减速）→ 绝对零度

6大武器 + 7种Buff + 进化系统完整保留。

---

## 八、外部成长系统（金币养成）

### 金币获取
- **通关奖励**：基础50 + 章节 × 8（第100章 = 850金币）
- **失败奖励**：通关奖励 × 30%（鼓励重试）
- **打砖块奖励**：游戏内每100砖块 = 1金币（上限每局50）
- **首通奖励**：首次通关某章节额外 × 2

### 永久升级（金币消耗）
| 属性 | 效果 | 满级 | 费用曲线 |
|------|------|------|----------|
| 基础攻击 | 子弹伤害+1/级 | 50 | 50 × 等级 |
| 基础射速 | 射击间隔-2%/级 | 30 | 80 × 等级 |
| 暴击率 | 初始暴击+1%/级 | 20 | 120 × 等级 |
| 起始等级 | 进入章节时自带等级（含随机Build） | 5 | 500 × 等级 |
| 金币加成 | 金币获取+5%/级 | 20 | 150 × 等级 |
| 经验加成 | 经验获取+3%/级 | 20 | 100 × 等级 |

### 升级界面
- 章节选择界面侧边栏或底部Tab
- 每个属性显示：当前等级/满级、效果预览、升级费用
- 金币不足时灰显

---

## 九、道具系统（保留+微调）

砖块碎裂15%概率掉落，与v1一致：

| 类型 | 效果 | 持续 |
|------|------|------|
| 射速UP | 射击间隔×0.5 | 10秒 |
| 散射 | 子弹+2发 | 10秒 |
| 分数 | +金币（章节相关） | 即时 |

> "分数"道具改为直接加金币（与外部养成挂钩）。

---

## 十、视觉特效（保留+新增）

### 保留
- 深空背景 + 30颗星星
- 发射器梯形飞船 + 尾焰
- 砖块受击闪白 / 危险线呼吸 / 屏幕震动
- 粒子爆破 / Combo光环
- 零 shadowBlur 性能优化方案

### 新增
- **快速砖块**：橙色速度线拖影
- **护盾砖块**：白色半透明外框 + 破碎粒子
- **分裂砖块**：裂纹纹理 + 分裂爆发
- **隐身砖块**：alpha渐变闪烁 + 鬼影
- **治愈砖块**：绿色脉冲波纹扩散
- **Boss登场**：全屏警告 + "WARNING" 文字 + 屏幕变暗
- **Boss特有特效**：各Boss独立视觉（冲锋火焰/护盾旋转/召唤传送门/激光充能/瞬移残影）
- **通关特效**：Boss爆炸 + "CHAPTER CLEAR" + 金币飞出

---

## 十一、UI流程

### 标题画面
```
┌──────────────────────────┐
│                          │
│      NEON BREAKER        │
│        无限飞机          │
│                          │
│     [ 开始游戏 ]         │
│                          │
│        v2.0              │
└──────────────────────────┘
```

### 章节选择
```
┌──────────────────────────┐
│ 💰 12,350        [升级]  │
│                          │
│  ┌─────┐ ┌─────┐ ┌─────┐│
│  │ 1 ✅│ │ 2 ✅│ │ 3 ✅││
│  │🔴   │ │🔵   │ │🟣   ││
│  └─────┘ └─────┘ └─────┘│
│  ┌─────┐ ┌─────┐ ┌─────┐│
│  │ 4 ✅│ │ 5   │ │ 🔒  ││
│  │🟡   │ │⚪   │ │     ││
│  └─────┘ └─────┘ └─────┘│
│         ...              │
│                          │
└──────────────────────────┘
```

### 战斗UI（同v1，略微调整）
```
┌──────────────────────────┐
│ CH.5   SCORE:xxx  Lv.x   │ ← 增加章节号
│ COMBO x5          WAVE x │
│                    [⟐]   │
│    ████  ████  ████      │
│    ████  ████  ████      │
│ - - - 危险线 - - -       │
│         ▲                │
│ ♪                        │
│ ████████████████  Lv.5   │
└──────────────────────────┘
```

### 通关结算
```
┌──────────────────────────┐
│                          │
│    ✨ CHAPTER 5 CLEAR ✨ │
│                          │
│    得分: 12,580          │
│    等级: Lv.9            │
│    最高Combo: 47         │
│                          │
│    你的Build:            │
│    ⟐3 🔥2 ⚡4 »5 ✕3    │
│                          │
│    💰 +180 金币          │
│    (首通 ×2!)            │
│                          │
│    [ 下一章 ]  [ 返回 ]  │
│                          │
└──────────────────────────┘
```

---

## 十二、数据存储

使用 `wx.setStorageSync` / `wx.getStorageSync`：

```json
{
  "maxChapter": 5,
  "coins": 12350,
  "upgrades": {
    "attack": 3,
    "fireRate": 2,
    "crit": 1,
    "startLevel": 0,
    "coinBonus": 1,
    "expBonus": 0
  },
  "chapterRecords": {
    "1": { "cleared": true, "bestScore": 15200, "bestLevel": 10 },
    "2": { "cleared": true, "bestScore": 12800, "bestLevel": 9 }
  }
}
```

---

## 十三、技术架构（改动点）

### 新增文件
```
src/
  ChapterConfig.js   - 100章数值配置 + 砖块出现规则 + Boss分配
  ChapterSelect.js   - 章节选择界面逻辑
  BrickFactory.js    - 7种砖块工厂（替代原generateBrickRow）
  BossFactory.js     - 5种Boss工厂（替代原Boss.js）
  SaveManager.js     - 存档读写（金币/进度/升级）
  UpgradeShop.js     - 外部升级商店逻辑
```

### 改动文件
```
  Game.js            - 状态机增加 CHAPTER_SELECT / CHAPTER_CLEAR
  Renderer.js        - 新增章节选择/结算/Boss警告/新砖块渲染
  Config.js          - 移除固定难度参数，改为从ChapterConfig读取
  Brick.js           - 拆分为基类+7个子类型
  Boss.js            - 拆分为基类+5个Boss类型
```

### 状态机（新）
```
LOADING → TITLE → CHAPTER_SELECT ⇄ UPGRADE_SHOP
                        ↓
                    PLAYING → BOSS → CHAPTER_CLEAR → CHAPTER_SELECT
                      ↓                                    
                  LEVEL_UP                              
                      ↓
                  GAME_OVER → CHAPTER_SELECT
```

---

## 十四、开发优先级

### Phase 1：核心章节循环（最高优先）
1. 章节选择界面 + 数据存储
2. ChapterConfig（100章数值缩放）
3. Game.js 状态机改造（章节制）
4. 通关结算界面
5. 金币系统 + 外部升级商店

### Phase 2：砖块多样性
6. 护盾砖块
7. 快速砖块（已有概念，需独立类型化）
8. 分裂砖块
9. 阵型砖块（5种阵型）
10. 隐身砖块
11. 治愈砖块

### Phase 3：Boss系统
12. 冲锋者
13. 护盾卫士
14. 召唤师
15. 激光炮台
16. 幽影刺客
17. Boss循环增强机制

### Phase 4：打磨
18. 难度节奏曲线调优
19. 新砖块视觉特效
20. Boss登场/通关动画
21. 音效补充（新砖块+Boss）
22. 数值平衡测试

---

## 十五、与v1的主要差异

| 维度 | v1（无限生存） | v2（章节制） |
|------|---------------|-------------|
| 结构 | 无限跑，越久越难 | 100章，每章~10分钟 |
| 目标 | 活得久=高分 | 打Boss通关 |
| 难度 | 线性递增 | 锯齿波节奏（松紧交替） |
| 砖块 | 仅HP/颜色不同 | 7种行为差异化砖块 |
| Boss | 简单左右移动 | 5种独立机制Boss |
| 成长 | 无 | 金币永久升级 |
| Build | 随机