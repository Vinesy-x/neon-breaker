# 武器数值平衡 · 最终模型与验证流程

> 2026-03-02 | 阿喵 & Vin
> 本文档是数值平衡的**唯一真理源**，取代所有旧文档。

---

## 一、公式体系

### 1.1 基础伤害公式

```
单次伤害 = baseAttack × basePct × shopDmgMult × branchDmgMult
```

| 变量 | 说明 | 来源 |
|------|------|------|
| baseAttack | 玩家基础攻击力（永久升级） | 沙盒中固定为 1 |
| basePct | 武器基础百分比 | WeaponBalanceConfig.js |
| shopDmgMult | 局外养成 · 商店成长曲线 | getDmgMultiplier(shopLv) |
| branchDmgMult | 局内肉鸽 · damage 分支加成 | 1 + damageLv × 0.5 |

### 1.2 DPS公式

```
DPS = 单次伤害 × effectiveHits × frequency × stormMult × echoMult × ...

简化为：
DPS = basePct × baseAttack × shopDmgMult × (局内总乘数) × frequency
```

### 1.3 核心系数总览

| 系数 | 说明 | 设计目标 |
|------|------|---------|
| basePct | 武器基础百分比，决定武器间初始强度差异 | 武器间差距 <3x |
| shopDmgMult | 局外养成曲线，所有武器共享 | 每10级 ≈ ×3 |
| 爽点倍率 | 商店5倍数级的特殊提升（CD/链数/齐射等） | 补足共享曲线缺口 |
| 局内 n 值 | 每个分支点的等效DPS乘数 | n ≈ 1.25~1.30 |
| branchDmgMult | damage 分支，加法 +50%/点 | 10点 = ×6.0 |
| effectiveHits | 武器机制命中数 | 区分武器类型 |

### 1.4 无分支Lv1基础DPS标定

```
设计目标：所有武器的无分支Lv1 DPS ≈ 1.5
```

| 参考系 | interval | effHits | DPS | 说明 |
|--------|----------|---------|-----|------|
| 飞机子弹 | 800ms | 1 | 1.25 | 最低参照线 |
| **武器标准** | — | — | **1.5** | 设计锚点 |

这是一个**设计输入**，不是从武器参数算出的结果。
确定 1.5 之后，各武器的 basePct 由公式反推：

```
basePct = targetDPS × (CD / 1000) / effHits
        = 1.5 × (CD / 1000) / effHits
```

| 武器 | CD(ms) | effHits | basePct(反推) |
|------|--------|---------|--------------|
| 冰爆弹 | 6000 | 6 | 1.50 |
| 闪电链 | 3800 | 3 | 1.90 |
| 穿甲弹 | 4500 | 4.26 | 1.58 |
| 轰炸机 | 12000 | 8 | 2.25 |

> basePct 的差异来自 CD 和 effHits 的不同，但最终 DPS 在 1.5 处对齐。

### 1.5 武器类型与 effectiveHits 维度

不同类型的武器，effectiveHits 的计算方式和标定目标不同：

| 类型 | 代表武器 | effectiveHits 构成 | 特征 |
|------|---------|-------------------|------|
| AOE范围型 | 冰爆弹、轰炸机 | 爆炸覆盖砖块数 | 密集环境DPS高，稀疏环境DPS低 |
| 链式传导型 | 闪电链 | 链数 × 每跳伤害系数 | 分散目标高效，密集时受链距限制 |
| 纵深穿透型 | 穿甲弹 | 齐射数 × 穿透层数 | 纵列密集时爆发，横向覆盖差 |

> 同一 DPS 数值，不同类型武器的实战表现可能差异很大。
> 沙盒测试使用「均匀满屏」环境来统一比较。

---


## 二、局内肉鸽（单局分支成长）

### 2.1 分支乘数模型

每把武器有 24~26 个分支点，每次升级选择 1 个分支点。

```
满分支DPS ≈ 无分支DPS × n^totalPoints

其中：
  n = 等效每点DPS乘数
  totalPoints = 该武器总分支点数
```

### 2.2 设计目标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 等效 n | 1.25 ~ 1.30 | 每点约 +25%~30% 等效DPS |
| 25点总乘数 | 264x ~ 705x | n^25 |
| damage 分支(10点) | ×6.0 | 加法 +50%/点，最大占比 |
| 机制分支 | 看类型 | 见2.3 |
| 功能分支(减速/DOT) | ×1.0~1.3 | 非直接DPS，允许低乘数 |

### 2.3 分支类型系数标定

| 分支类型 | 等效n范围 | 例子 | 说明 |
|---------|----------|------|------|
| 🔴 乘法型 | 1.4~1.7 | storm(×1.73/点), count(多发) | 直接倍增输出频次或数量 |
| 🟡 增益型 | 1.15~1.35 | chains, charge, aoe, pierce | 扩大覆盖或提升每次收益 |
| 🟢 功能型 | 1.00~1.15 | paralyze, shock(DOT), napalm | 控制/辅助，DPS贡献小 |

### 2.4 分支协同与红线

- **乘法×乘法禁止双重叠加超 ×4**：如 storm(×3) × count(×3) = ×9 → 过强
- **加法型 damage 是安全的锚点**：(1+n×0.5) 增量递减，10点后每点只+8%
- **功能型分支允许低贡献**：减速、DOT 的价值在实战而非沙盒

### 2.5 单局DPS成长曲线

假设 25 个分支点在单局内均匀获取：

| 分支点数 | n=1.25 | n=1.28 | n=1.30 |
|---------|--------|--------|--------|
| 5  | ×3.1 | ×3.4 | ×3.7 |
| 10 | ×9.3 | ×11.8 | ×13.8 |
| 15 | ×28.4 | ×40.6 | ×51.2 |
| 20 | ×86.7 | ×139 | ×190 |
| 25 | ×264 | ×478 | ×705 |

> 这决定了玩家在单局中的"变强体感"。n 过低(<1.20)则后期无感，n 过高(>1.35)则前期太弱后期太爆。

---

## 三、局外养成（商店等级成长）

### 3.1 共享成长曲线

所有武器共享同一条 shopDmgMult 曲线：

```
dmgMultPerBracket: [0.12, 0.20, 0.35, 0.36, 0.38]
                    Lv1-5  6-10  11-15 16-20  21+
规则：5倍数级不加伤害（为爽点级），其余每级 +bracket值
```

| ShopLv | shopDmgMult | 段间比(每10级) |
|--------|-------------|---------------|
| 1  | 1.00 | — |
| 10 | 2.16 | — |
| 20 | 5.00 | 10→20 = ×2.31 |
| 30 | 8.04 | 20→30 = ×1.61 |

### 3.2 爽点系统

商店每 5 级的「爽点级」不加伤害，而是提升武器的**机制属性**：

| 爽点类型 | 适用武器 | 效果 | 设计意图 |
|---------|---------|------|---------|
| CD缩短 | 冰爆弹、轰炸机 | 降低释放间隔 | 频率提升 = 乘法增DPS |
| 链数增加 | 闪电链 | +1 链跳目标 | 覆盖面提升 |
| 齐射增加 | 穿甲弹 | +1 发连射 | 爆发量提升 |

### 3.3 10级×3 倍率分解

**目标**：每 10 个商店等级，武器综合 DPS ≈ ×3。

这个 ×3 由**四种局外成长**共同贡献：

```
段间比 = 共享曲线 × 爽点属性 × 被动技能 × 新解锁分支（间接）
```

#### 四种局外成长来源

| 来源 | 获取方式 | 效果类型 | 每10级里程碑 |
|------|---------|---------|------------|
| 共享伤害曲线 | 非5倍数级自动获得 | 直接乘法增伤 | 8次(每级+bracket) |
| 爽点属性 | 每5级获得 | CD/链数/齐射等 | 2次(Lv5,10) |
| 被动技能 | Lv6/14/22/26/30 解锁 | 永久增强 | ~2个被动 |
| 新分支解锁 | Lv2/10/18 解锁 | 新选项进三选一池 | ~1个新分支 |

#### 被动技能的贡献

被动技能是**永久生效**的乘数，不需要局内选择：

| 等级段 | 典型被动效果 | 估算DPS贡献 |
|--------|------------|-----------|
| 前期(Lv6) | 移除惩罚/标记增伤 | ×1.15~1.30 |
| 中期(Lv14) | DOT增强/新伤害源 | ×1.20~1.40 |
| 后期(Lv22-30) | 核心机制强化 | ×1.30~2.00 |

> 被动技能效果差异大（从标记+15%到核弹伤害×5），需逐武器评估。

#### 新分支解锁的间接贡献

Lv2/10/18 解锁的分支进入局内三选一池。它们不直接加DPS，但**提高了局内 n 值**：
- 低等级(仅基础分支)：可选项少，n 可能只有 1.20
- 高等级(全部解锁)：可选项多，更多乘法型分支可选，n 提升至 1.28+

#### 综合分解

| 段 | 共享曲线 | 爽点 | 被动(估) | 新分支(间接) | 目标合计 | 容忍范围 |
|----|---------|------|---------|------------|---------|---------|
| 1→10 | ×2.16 | ×1.20~1.39 | ×1.15 | 提升n | ×3.0 | ×2.0~×4.0 |
| 10→20 | ×2.31 | ×1.25~1.30 | ×1.20 | 提升n | ×3.0 | ×2.0~×4.0 |
| 20→30 | ×1.61 | ×1.33~1.86 | ×1.40 | — | ×3.0 | ×2.0~×4.0 |

> 20→30 段共享曲线最弱(×1.61)，需要爽点和被动共同补偿。
> 后期被动(Lv22/26/30)往往是质变型(如「末日弹幕」弹数×2、「核弹」伤害×5)，贡献更大。

### 3.4 局外养成节奏

| 商店等级 | DPS倍率(vs Lv1) | 玩家体感 |
|---------|----------------|---------|
| 1 | ×1 | 初始体验 |
| 10 | ×3 | 明显变强 |
| 20 | ×9 | 质变感 |
| 30 | ×27 | 满级巅峰 |

### 3.5 目标锚点

| 指标 | 目标 | 容忍范围 |
|------|------|---------|
| 每10级DPS倍率 | ×3 | ×2.0 ~ ×4.0 |
| Lv30 最强/最弱武器比 | <2x | <3x |
| 武器身份感 | 各有特色 | DPS不追求完全相同 |

### 3.6 被动加成红线

| 类型 | 安全范围 | 红线 |
|------|---------|------|
| 加法增伤 | +30%~50% | 禁止 +100% 以上 |
| 乘法增伤 | ×1.3~1.5 | 禁止 ×2.0 以上 |
| CD缩短 | ×0.67~0.8 | 禁止 ×0.5 以下 |
| 频率×乘法双重 | — | 禁止同时存在 |
| 无上限叠加 | — | 禁止 |

---

## 四、模型输出

> 综合公式体系(一)、局内肉鸽(二)、局外养成(三)，输出通用标定值。
> 这些值**不绑定任何具体武器**，是判断武器数值是否健康的统一标尺。

### 4.1 总成长倍率

```
总成长倍率 = 局外成长(shopLv) × 局内成长(n, pts)

局外成长 = shopDmgMult(lv) × sweetSpotGrowth(lv)
局内成长 = n ^ totalPoints
```

**局外成长倍率**（基于每10级×3目标）：

| ShopLv | 共享曲线 | 爽点目标贡献 | 局外总倍率(vs Lv1) |
|--------|---------|------------|-------------------|
| 1  | ×1.00 | ×1.00 | **×1** |
| 10 | ×2.16 | ×1.39 | **×3** |
| 20 | ×5.00 | ×1.80 | **×9** |
| 30 | ×8.04 | ×3.36 | **×27** |

**局内成长倍率**（n=1.25 统一）：

| 可用点数 | 分支乘数 | 说明 |
|----------|---------|------|
| 20 | ×86.7 | 基础分支（shopLv 1~4） |
| 22 | ×135.5 | +Lv5 解锁分支 |
| 24 | ×211.8 | +Lv10 解锁分支 |
| 25 | ×264.7 | +Lv10（25点武器） |
| 26 | ×330.9 | 全分支（shopLv≥18） |

> 所有武器基础分支 = 20 点，shopGated 分支在 Lv5/10/18 逐步解锁

### 4.2 总成长倍率表（局外×局内，n=1.25）

各 shopLv 下**实际可用分支点数 × 局外成长**的总倍率（相对无分支Lv1）：

| ShopLv | 可用点数 | 分支乘数 | 局外倍率 | 总倍率 |
|--------|---------|---------|---------|--------|
| Lv1  | 20 | ×86.7  | ×1  | **×87** |
| Lv10 | 25 | ×264.7 | ×3  | **×794** |
| Lv20 | 26 | ×330.9 | ×9  | **×2,978** |
| Lv30 | 26 | ×330.9 | ×27 | **×8,934** |

> 注：可用点数以26点武器(kunai)为例。24/25点武器数值略低。
> 解锁节点：Lv5 +1分支, Lv10 +1分支, Lv18 +1分支

### 4.3 如何使用

```
某武器的预测DPS = 无分支Lv1基础DPS × 总成长倍率

例：某武器无分支Lv1 DPS = 10，n=1.28，25点
  → Lv1满分支预测 = 10 × 479 = 4,790
  → Lv30满分支预测 = 10 × 12,930 = 129,300
```

**验证流程**：
1. 先算出武器的「无分支Lv1基础DPS」（由 basePct / CD / effHits 决定）
2. 估算武器的等效 n 值（分支拆解）
3. 查表得到总成长倍率
4. 预测DPS = 基础DPS × 倍率
5. 沙盒实测 vs 预测 → 误差 <30% 为模型可信

**标定意义**：
- 如果实测远高于预测 → 该武器的分支乘数设计偏强，需要削弱
- 如果实测远低于预测 → 分支存在无效点或bug，需要排查
- 武器间 Lv30 预测DPS 差距超过 ×3 → basePct 需要调整

---

## 五、四把基础武器设定

### 5.1 冰爆弹 (kunai)

**定位**：AOE范围清场，密集砖克星 | **类型**：AOE范围型

| 参数 | 值 | 来源 |
|------|-----|------|
| basePct | 12.0 | WeaponBalanceConfig |
| interval | 6000ms（仅初始参考） | WeaponBalanceConfig |
| 爽点 | CD缩短: base=6000, delta=-500/5级 | WeaponShopDefs |
| CD下限 | 3000ms | Kunai.js:372 |
| 分支总点数 | 26 | damage(10)+count(3)+aoe(4)+pierce(2)+pierceBlast(1)+chain(2)+splitBomb(3)+giant(1) |

**爽点10级贡献**：
- 1→10: 频率×1.20，共享×2.16 → 合计 ×2.59
- 10→20: 频率×1.25，共享×2.31 → 合计 ×2.89
- 20→30: 频率×1.33，共享×1.61 → 合计 ×2.14

---

### 5.2 闪电链 (lightning)

**定位**：链式传导，分散目标高效 | **类型**：链式传导型

| 参数 | 值 | 来源 |
|------|-----|------|
| basePct | 9.0 | WeaponBalanceConfig |
| interval | 3800ms（固定） | WeaponBalanceConfig |
| 爽点 | 链数: base=3, delta=+1/5商店级 | WeaponShopDefs |
| 分支chains | +2链/分支点 | Lightning.js:85 |
| 链衰减 | ❌ 无衰减 | 每跳等伤，charge使递增 |
| 分支总点数 | 25 | damage(10)+chains(4)+charge(2)+shock(2)+echo(2)+paralyze(2)+storm(2)+overload(1) |

**爽点10级贡献**（无衰减，effHits=链数）：
- 1→10: 链数×1.67，共享×2.16 → 合计 ×3.60
- 10→20: 链数×1.40，共享×2.31 → 合计 ×3.23
- 20→30: 链数×1.29，共享×1.61 → 合计 ×2.07

---

### 5.3 穿甲弹 (missile)

**定位**：纵深穿透，高伤单列清扫 | **类型**：纵深穿透型

| 参数 | 值 | 来源 |
|------|-----|------|
| basePct | 32 | WeaponBalanceConfig |
| interval | 4500ms（固定） | WeaponBalanceConfig |
| 爽点 | 齐射数: base=1, delta=+1/5级 | WeaponShopDefs |
| 穿透衰减 | 8%/穿 | decayRate=0.08 |
| 分支总点数 | 24 | damage(10)+pierce(2)+salvo(3)+dotExploit(1)+twinCannon(2)+shockwave(2)+deepPierce(2)+hyperVelocity(1)+twinCannonAdv(1) |

**爽点10级贡献**：
- 1→10: 齐射×3.00，共享×2.16 → 合计 ×6.48 ⚠️
- 10→20: 齐射×1.67，共享×2.31 → 合计 ×3.86
- 20→30: 齐射×1.40，共享×1.61 → 合计 ×2.25

---

### 5.4 轰炸机 (meteor)

**定位**：低频高伤，大范围覆盖事件 | **类型**：AOE范围型

| 参数 | 值 | 来源 |
|------|-----|------|
| basePct | 12 | WeaponBalanceConfig |
| interval | 12000ms（仅初始参考） | WeaponBalanceConfig |
| 爽点 | CD缩短: base=12000, delta=-1500/5级 | WeaponShopDefs |
| CD下限 | 3000ms | 30级刚好=3000 |
| baseBombs | 4 | WeaponBalanceConfig |
| 分支总点数 | 24 | damage(10)+bombs(3)+radius(3)+napalm(2)+carpet(2)+escort(2)+incendiary(1)+b52(1) |

**爽点10级贡献**：
- 1→10: 频率×1.33，共享×2.16 → 合计 ×2.88
- 10→20: 频率×1.50，共享×2.31 → 合计 ×3.47
- 20→30: 频率×2.00，共享×1.61 → 合计 ×3.22

---

## 六、验证流程（单武器）

### Step 1: 机制验证 + Lv1基线
```
方法：10x速度，120s测量，Lv1商店等级（满分支），3次取平均
检查：实测DPS 是否在 [Lv1理论DPS × n^pts] 的 ±30% 内
```

### Step 2: 倍速校准（5x vs 20x）
```
方法：同一武器+同一环境，Lv20，各跑1次
判定：偏差 <10% → 20x可用
```

### Step 3: 全等级基线
```
方法：10x，120s，Lv1/10/20/30 各3次
输出：段间比 vs 模型预测，CV <10% 为可信
```

### Step 4: 数值调整
```
优先级：basePct > 爽点delta > interval
每轮只改1个参数
```

### Step 5: 定调记录

---

## 七、最终数值记录

> 每把武器定调后填入此处。

### 轰炸机 (meteor)
```
状态: 待验证
```

### 冰爆弹 (kunai)
```
状态: 待验证
```

### 闪电链 (lightning)
```
状态: 待验证
```

### 穿甲弹 (missile)
```
状态: 待验证
```

---

*"先量准尺子，再量布料。"* 🐾
