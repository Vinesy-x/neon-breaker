# 无限飞机 - 游戏设计文档

> 版本：v4.2.1 | 更新日期：2026-02-20

---

## 一、核心概念

**一句话**：赛博朋克风无限射击肉鸽小游戏，打飞机操控 + 打砖块目标 + 向僵尸开炮(Survivor.io)式Build套路。

**平台**：微信小游戏  
**技术栈**：纯 JS + Canvas 2D + CommonJS（零依赖）  
**美术风格**：深空背景 + 霓虹色（青/粉/绿/黄），全程代码绘制无图片资源  
**音效**：WebAudio 合成音效（零资源），赛博朋克电子音风格

---

## 二、核心玩法

### 操控方式
- **手指拖拽** = 底部发射器左右移动（类似打飞机）
- 发射器**自动往上射子弹**，玩家只管走位
- 单指操作，极度友好

### 游戏循环
```
开始 → 砖块从上方持续缓慢下移 → 发射器自动射击 → 打碎砖块掉经验球
→ 经验满了升级 → 三选一（武器/强化）→ 继续射击 → Boss战（每60秒）
→ 砖块到达危险线 = Game Over
```

### 无限生存模式
- **没有关卡概念**，砖块持续从顶部生成并缓慢下移
- 难度每25秒递增（WAVE+1）：砖块HP增加、下移加速、生成更密
- 玩家目标：活得越久、Build越强、分数越高

---

## 三、数值体系

### 砖块
| 参数 | 值 | 说明 |
|------|-----|------|
| 列数 | 7 | 固定7列 |
| 下移速度 | 0.16 px/frame | 每次难度+1增加0.015 |
| 生成间隔 | 2200ms | 每2.2秒生成新一行 |
| 空洞概率 | 12% | 每个位置12%概率不生成 |
| 难度递增 | 25000ms | 每25秒WAVE+1 |
| 危险线 | 屏幕78%处 | 砖块到这里=Game Over |

### 砖块HP（按难度WAVE）
| WAVE | HP分布 |
|------|--------|
| 0 | 全1HP |
| 1-2 | 30%概率2HP，否则1HP |
| 3-5 | 40%概率3HP，否则2HP |
| 6-9 | 均匀2-4HP |
| 10+ | 均匀3-6HP |

### 发射器
| 参数 | 值 |
|------|-----|
| 宽度 | 48px |
| 高度 | 28px |
| 造型 | 梯形飞船 + 炮管 + 尾焰 |

### 子弹
| 参数 | 值 |
|------|-----|
| 半径 | 4px |
| 速度 | 10 px/frame |
| 射击间隔 | 400ms（基础） |
| 上限 | 60颗同屏 |
| 拖尾 | 4帧 |
| 基础伤害 | 1 |

### 经验系统
| 参数 | 值 |
|------|-----|
| 每砖基础经验 | 3 |
| 每点HP额外经验 | 1 |
| 1级升级所需 | 300 |
| 每级增长系数 | 1.6x |
| 经验球行为 | 先弹出扩散 → 再飞向经验条 |

### Combo
- 连续摧毁砖块累计Combo
- 2秒没摧毁砖块 → Combo断裂归零
- 每5连击触发Combo音效+飘字
- 10连击以上爆发白色光环粒子
- 分数倍率 = 1 + floor(combo/5) × 0.5

### Boss
- 每60秒触发一次Boss战
- 3阶段HP（80/120/160 × 等级系数）
- 左右移动，越后阶段越快
- 击败奖励 500 × 击败次数 分

---

## 四、武器系统（6大武器）

参考"向僵尸开炮"(Survivor.io)，每个武器有**可见实体**在屏幕上自动攻击。

### 等离子刃 (orbitBlade) ⟐
- **类型**：环绕类
- **效果**：能量菱形刃绕发射器旋转，接触砖块造成伤害
- **5级成长**：数量1→4，伤害1→2，半径60→80，转速递增
- **进化**：量子旋涡 ◈（需满级+射速满级）→ 6刃，伤害3，半径90

### 烈焰涌动 (fireSurge) 🔥
- **类型**：波纹类
- **效果**：火焰横条从发射器向上扩散，经过砖块造成伤害
- **5级成长**：伤害1→3，间隔3s→1.5s，宽度40%→80%屏幕
- **进化**：炼狱风暴 🌋（需满级+暴击满级）→ 伤害4，全屏宽

### 链式闪电 (lightning) ⚡
- **类型**：自动锁定
- **效果**：从发射器向最近砖块释放闪电链，可连锁多个目标
- **5级成长**：伤害1→3，间隔2.5s→1.4s，连锁1→4个
- **进化**：雷神之怒 ⛈（需满级+穿透满级）→ 伤害4，6连锁

### 追踪导弹 (missile) ◆
- **类型**：自动追踪
- **效果**：自动发射追踪导弹飞向随机砖块
- **5级成长**：伤害2→3，间隔3.5s→1.8s，数量1→3
- **进化**：核弹洗地 ☢（需满级+散射满级）→ 4发，伤害5，AOE爆炸半径50

### 激光射线 (laserBeam) |
- **类型**：射线类
- **效果**：从发射器正上方发射垂直激光贯穿全屏
- **5级成长**：伤害1→3，间隔2s→1.1s，宽度3→8px
- **进化**：死亡射线 ‖（需满级+弹伤满级）→ 伤害5，宽12px

### 冰霜领域 (iceField) ❄
- **类型**：领域/减速
- **效果**：全局减缓砖块下移速度 + 定时发射冰锥攻击
- **5级成长**：减速85%→45%，冰伤1→3，间隔4s→2s
- **进化**：绝对零度 ✧（需满级+清屏满级）→ 减速30%，伤害4

---

## 五、基础强化（7种Buff）

| Key | 名称 | 效果 | 满级 | 图标 |
|-----|------|------|------|------|
| fireRate | 射速 | 射击间隔-10%/级 | 5 | » |
| spread | 散射 | 子弹+1发/级 | 3 | ⋮ |
| bulletDmg | 弹伤 | 子弹伤害+1/级 | 3 | ↑ |
| clearBomb | 清屏 | 选择时清除底部一行砖块 | 3 | 💥 |
| magnet | 磁力 | 道具自动吸附 | 1 | ⊕ |
| crit | 暴击 | 15%双倍伤害/级 | 3 | ✕ |
| pierce | 穿透 | 子弹穿透+1层/级 | 2 | ↟ |

---

## 六、进化系统

武器满级 + 对应Buff满级 = 自动进化为终极形态

| 武器 | 配套Buff | 进化结果 |
|------|----------|----------|
| 等离子刃 | 射速 | 量子旋涡 |
| 烈焰涌动 | 暴击 | 炼狱风暴 |
| 链式闪电 | 穿透 | 雷神之怒 |
| 追踪导弹 | 散射 | 核弹洗地 |
| 激光射线 | 弹伤 | 死亡射线 |
| 冰霜领域 | 清屏 | 绝对零度 |

---

## 七、升级选择机制

- 经验满升级时暂停游戏，弹出**3张并排卡片**
- 保证至少1个武器选项（如果有可选的）
- 新武器优先级 > 升级已有武器 > 基础强化
- 卡片UI：深色底 + 霓虹边框 + 图标 + 等级圆点 + NEW标签
- 一关内可多次升级（经验球持续收集）

---

## 八、道具系统

砖块碎裂15%概率掉落道具，缓慢下落，碰到发射器触发：

| 类型 | 效果 | 图标 | 持续 |
|------|------|------|------|
| 射速UP | 射击间隔×0.5 | » | 10秒 |
| 散射 | 子弹+2发 | ⋮ | 10秒 |
| 分数 | +50+难度×10分 | ★ | 即时 |

磁力Buff激活后道具自动吸向发射器。

---

## 九、视觉特效

### 背景
- 深空底色 `#080220`
- 30颗缓慢下移的闪烁星星

### 发射器
- 梯形飞船主体 + 白色炮管 + 霓虹顶端
- 发射口白色闪光（射击时）
- 底部动态三角尾焰（外焰+内焰随机闪烁）

### 战斗反馈
- 砖块受击闪白（4帧）
- 砖块接近危险线自动变红闪烁
- 危险线呼吸效果 + 渐变红色警告区
- 屏幕震动（高HP砖块摧毁时）
- 子弹命中冲击波环
- Combo 10+连击白色光环爆发
- 难度提升全屏 "WAVE X" 提示 + 屏幕震动

### 粒子系统
- 上限150个粒子
- 砖块碎裂：16个彩色碎片 + 4个白色闪光
- Boss受击：12个随机霓虹粒子
- Combo爆发：环形扩散 + 高连击白色光环

### 性能优化
- **零 shadowBlur**（用 globalAlpha + 叠层模拟发光）
- **零 createLinearGradient**（用半透明纯色矩形代替）
- 星空不用 sin 闪烁
- 经验球无发光

---

## 十、音效设计

全部 WebAudio 合成（oscillator + 白噪声），零资源文件：

| 事件 | 风格 |
|------|------|
| 子弹射击 | 极短促 pew（square 1200Hz） |
| 砖块碎裂 | 下滑音+碎裂噪声 |
| 道具拾取 | 上升音阶 ding-ding-ding |
| 经验球 | 极短 pling |
| 升级 | 华丽上升音阶+闪亮噪声 |
| 暴击 | 重击低频+噪声 |
| 闪电 | 电击噪声+高频碎裂 |
| 导弹爆炸 | 低频boom+噪声 |
| Boss登场 | 震撼低音 |
| Game Over | 悲伤下降音阶 |

---

## 十一、UI布局

```
┌──────────────────────────────┐
│ 安全区（胶囊按钮下方）        │
│ SCORE:xxx   Lv.x    WAVE x  │ ← HUD
│ COMBO x5                     │
│                        [⟐]  │ ← 右侧被动技能图标栏
│                        [🔥] │
│    ████  ████  ████         │ ← 砖块区域（持续下移）
│    ████  ████  ████         │
│    ████  ████               │
│                              │
│ - - - 危险线 - - -           │ ← 78%高度
│                              │
│         ▲                    │ ← 发射器
│         △ (尾焰)             │
│ ♪                            │ ← 音效开关
│ ███████████████████  Lv.5   │ ← 经验条
│ 安全区（底部）                │
└──────────────────────────────┘
```

---

## 十二、技术架构

### 文件结构（~7500行）
```
game.js          - 入口 + polyfills（roundRect/setTimeout）
game.json        - 小游戏配置
project.config.json
src/
  Config.js      - 全局配置常量（258行）
  Game.js        - 游戏主循环+状态机（739行）
  Renderer.js    - Canvas 2D 渲染器（915行）
  WeaponSystem.js - 6大武器实现（483行）
  Skill.js       - 升级管理器（206行）
  SoundManager.js - 合成音效（381行）
  Launcher.js    - 发射器（103行）
  Brick.js       - 砖块+行生成（89行）
  Bullet.js      - 子弹（67行）
  Particle.js    - 粒子系统（106行）
  PowerUp.js     - 道具（73行）
  Boss.js        - Boss战（86行）
  InputManager.js - 触摸输入（78行）
```

### 关键技术决策
1. **纯 Canvas 2D**：微信小游戏不支持 DOM，全部手绘
2. **CommonJS**：小游戏不支持 ES Modules
3. **零图片资源**：全部代码绘制，包大小极小
4. **零音频资源**：WebAudio 合成，不需要音频文件
5. **DPR 适配**：canvas 尺寸 × pixelRatio，ctx.scale 缩放
6. **安全区域**：胶囊按钮 + iPhone X 底部安全区适配
7. **roundRect polyfill**：低版本基础库用 arcTo 实现

### 状态机
```
LOADING → TITLE → PLAYING ⇄ BOSS
                    ↓          ↓
                LEVEL_UP   LEVEL_UP
                    ↓          ↓
                GAME_OVER → TITLE
```

---

## 十三、已知问题 & 待优化

- [ ] Boss战设计较简单（左右移动+被动挨打），可加子弹/技能
- [ ] 没有存档/排行榜
- [ ] 没有新手引导
- [ ] 武器视觉可进一步丰富（进化形态特效）
- [ ] 音效开关UI较简陋
- [ ] 没有分享/社交功能

---

*文档由阿喵整理 🐾*
